<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Bot System - ‰∫ßÂìÅÂàÜÁ±ªÁÆ°ÁêÜ</title>
    <!-- Vue 3 - Êú¨Âú∞Êñá‰ª∂ -->
    <script src="libs/vue.global.js"></script>
    <!-- Element Plus - Êú¨Âú∞Êñá‰ª∂ -->
    <link rel="stylesheet" href="libs/element-plus.css" />
    <script src="libs/element-plus.js"></script>
    <!-- Element Plus Icons - Êú¨Âú∞Êñá‰ª∂ -->
    <script src="libs/element-plus-icons.js"></script>
    <!-- Socket.IO - Êú¨Âú∞Êñá‰ª∂ -->
    <script src="libs/socket.io.min.js"></script>
    <!-- Axios - Êú¨Âú∞Êñá‰ª∂ -->
    <script src="libs/axios.min.js"></script>
    <!-- Day.js - Êú¨Âú∞Êñá‰ª∂ -->
    <script src="libs/dayjs.min.js"></script>
</head>
<body>
    <div id="app">
        <el-container style="height: 100vh;">
            <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
            <el-header class="header">
                <div class="header-left">
                    <h2>Apple Bot System</h2>
                </div>
                <div class="header-right">
                    <div class="status-indicators">
                        <el-badge :value="pendingTasks.length" type="info" :hidden="pendingTasks.length === 0">
                            <el-button size="small" disabled>
                                ‚è≥ Á≠âÂæÖ
                            </el-button>
                        </el-badge>

                        <el-badge :value="runningTasks.length" type="warning" :hidden="runningTasks.length === 0">
                            <el-button size="small" disabled>
                                üèÉ ËøêË°å
                            </el-button>
                        </el-badge>

                        <el-badge :value="systemStatus.active_tasks" type="primary" class="status-badge">
                            <el-button
                                :type="isConnected ? 'success' : 'danger'"
                                size="small"
                                circle
                            >
                                {{ isConnected ? '‚úì' : '‚úó' }}
                            </el-button>
                        </el-badge>
                    </div>

                    <el-button
                        type="success"
                        @click="startAllTasks"
                        :disabled="!hasExecutableTasks"
                        :loading="startingAllTasks"
                    >
                        üöÄ ‰∏ÄÈîÆÊâßË°åÊâÄÊúâ‰ªªÂä°
                    </el-button>

                    <el-button
                        type="info"
                        @click="refreshTasks"
                        size="small"
                    >
                        üîÑ Âà∑Êñ∞
                    </el-button>

                    <el-dropdown @command="handleCommand">
                        <el-button type="primary">
                            Á≥ªÁªüÁÆ°ÁêÜ
                        </el-button>
                        <template #dropdown>
                            <el-dropdown-menu>
                                <el-dropdown-item command="status">Á≥ªÁªüÁä∂ÊÄÅ</el-dropdown-item>
                                <el-dropdown-item command="logs">ËøêË°åÊó•Âøó</el-dropdown-item>
                                <el-dropdown-item command="settings">Á≥ªÁªüËÆæÁΩÆ</el-dropdown-item>
                                <el-dropdown-item command="stop-all" divided>ÂÅúÊ≠¢ÊâÄÊúâ‰ªªÂä°</el-dropdown-item>
                            </el-dropdown-menu>
                        </template>
                    </el-dropdown>
                </div>
            </el-header>

            <el-container>
                <!-- ‰æßËæπÊ†è - ‰∫ßÂìÅÂàÜÁ±ªÂØºËà™ -->
                <el-aside width="220px" class="sidebar">
                    <el-menu
                        :default-active="currentProduct"
                        class="menu"
                        @select="switchProduct"
                        :collapse="false"
                    >
                        <el-menu-item index="iphone">
                            <span>üì± iPhone</span>
                        </el-menu-item>
                        <el-menu-item index="mac">
                            <span>üíª Mac</span>
                        </el-menu-item>
                        <el-menu-item index="ipad">
                            <span>üì± iPad</span>
                        </el-menu-item>
                        <el-menu-item index="watch">
                            <span>‚åö Apple Watch</span>
                        </el-menu-item>
                        <el-divider style="margin: 10px 0;"></el-divider>
                        <el-menu-item index="all-tasks">
                            <span>üìã ÊâÄÊúâ‰ªªÂä°</span>
                        </el-menu-item>
                        <el-divider style="margin: 10px 0;"></el-divider>
                        <el-menu-item index="accounts">
                            <span>üë§ Ë¥¶Âè∑ÁÆ°ÁêÜ</span>
                        </el-menu-item>
                        <el-menu-item index="gift-cards">
                            <span>üéÅ Á§ºÂìÅÂç°ÁÆ°ÁêÜ</span>
                        </el-menu-item>

                        <el-menu-item index="ip-pool">
                            <span>üåê IPÊ±†ÁÆ°ÁêÜ</span>
                        </el-menu-item>
                    </el-menu>
                </el-aside>

                <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                <el-main class="main-content">
                    <!-- iPhone ‰∫ßÂìÅÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'iphone'" class="product-section">
                        <div class="section-header">
                            <h2>üì± iPhone Ëá™Âä®Âåñ‰ªªÂä°</h2>
                            <div class="header-actions">
                                <el-button
                                    type="success"
                                    @click="startIphoneTasks"
                                    :disabled="!hasIphonePendingTasks"
                                    size="small"
                                >
                                    üöÄ ÂêØÂä®ÊâÄÊúâiPhone‰ªªÂä°
                                </el-button>
                                <el-button
                                    type="primary"
                                    @click="openCreateDialog('iphone')"
                                >
                                    ÂàõÂª∫ iPhone ‰ªªÂä°
                                </el-button>
                            </div>
                        </div>

                        <div class="tasks-grid">
                            <el-card
                                v-for="task in getTasksByProduct('iphone')"
                                :key="task.id"
                                class="task-card"
                                shadow="hover"
                            >
                                <template #header>
                                    <div class="card-header">
                                        <span class="task-name">{{ task.config.name }}</span>
                                        <el-tag :type="getStatusType(task.status)" size="small">
                                            {{ getStatusText(task.status) }}
                                        </el-tag>
                                    </div>
                                </template>

                                <div class="task-details">
                                    <p><strong>Apple ID:</strong> {{ task.config.account_config?.email || 'N/A' }}</p>
                                    <p><strong>ÂûãÂè∑:</strong> {{ task.config.product_config?.model || 'N/A' }}</p>
                                    <p><strong>Â≠òÂÇ®:</strong> {{ task.config.product_config?.storage || 'N/A' }}</p>
                                    <p><strong>È¢úËâ≤:</strong> {{ task.config.product_config?.finish || 'N/A' }}</p>

                                    <!-- ÂΩìÂâçÊ≠•È™§ÊòæÁ§∫ -->
                                    <div v-if="task.status === 'running' && task.current_step" class="current-step">
                                        <p><strong>ÂΩìÂâçÊ≠•È™§:</strong>
                                            <el-tag type="primary" size="small">
                                                {{ formatStepName(task.current_step) }}
                                            </el-tag>
                                        </p>
                                    </div>

                                    <!-- ÂÆûÊó∂ËøõÂ∫¶Êù° -->
                                    <el-progress
                                        :percentage="Math.round(task.progress || 0)"
                                        :status="task.status === 'completed' ? 'success' :
                                                task.status === 'failed' ? 'exception' : ''"
                                        :stroke-width="8"
                                        style="margin: 10px 0;"
                                        :show-text="true"
                                        :format="(percentage) => `${percentage}% ${task.status === 'running' ? 'ÊâßË°å‰∏≠...' : ''}`"
                                    ></el-progress>

                                    <!-- ‰ΩôÈ¢ù‰∏çË∂≥ÈîôËØØÊòæÁ§∫ -->
                                    <div v-if="task.balance_error" class="balance-error">
                                        <div class="error-header">
                                            <span style="color: #f56c6c; margin-right: 8px;">üí≥</span>
                                            <span>‰ΩôÈ¢ù‰∏çË∂≥</span>
                                        </div>
                                        <div class="error-content">
                                            <div class="error-amount">ËøòÈúÄÊîØ‰ªò: <strong>{{ task.balance_error.remaining_amount }}</strong></div>
                                            <div class="error-message">{{ task.balance_error.message }}</div>
                                        </div>
                                    </div>

                                    <!-- üöÄ ÁÆÄÂåñÁöÑÁ§ºÂìÅÂç°ËæìÂÖ•Âå∫Âüü - Âä®ÊÄÅÊòæÁ§∫ -->
                                    <div v-if="task.status === 'waiting_gift_card_input'" class="gift-card-input-section"
                                         style="margin: 15px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">

                                        <div style="text-align: center; margin-bottom: 20px;">
                                            <h3 style="margin: 0 0 8px 0; color: white;">üéÅ Á§ºÂìÅÂç°ËæìÂÖ•</h3>
                                            <p style="margin: 0; opacity: 0.9;">‰ªªÂä°Â∑≤Âà∞Ëææ‰ªòÊ¨æÈ°µÈù¢ÔºåËØ∑ËæìÂÖ•Á§ºÂìÅÂç°Âè∑Á†ÅÁªßÁª≠ÊâßË°å</p>
                                        </div>

                                        <!-- üéØ Áõ¥Êé•ÊòæÁ§∫ËæìÂÖ•Ë°®ÂçïÔºå‰∏çÈúÄË¶ÅÂàùÂßãÂåñÊåâÈíÆ -->
                                        <div>
                                            <!-- Á§ºÂìÅÂç°ËæìÂÖ•Ê°ÜÂàóË°® -->
                                            <div v-for="(card, index) in getTaskGiftCardInputs(task.id)" :key="index"
                                                 style="display: flex; gap: 10px; margin-bottom: 12px; align-items: center;">
                                                <span style="min-width: 60px; opacity: 0.9; font-weight: bold;">Âç°Áâá{{ index + 1 }}:</span>
                                                <el-input
                                                    v-model="card.number"
                                                    placeholder="ËæìÂÖ•16‰ΩçÁ§ºÂìÅÂç°Âè∑Á†Å"
                                                    size="default"
                                                    style="flex: 1;"
                                                    clearable
                                                    maxlength="20"
                                                    @input="onGiftCardInput(task.id, index, $event)"
                                                />
                                                <el-button
                                                    type="danger"
                                                    size="small"
                                                    @click="removeTaskGiftCardInput(task.id, index)"
                                                    v-if="getTaskGiftCardInputs(task.id).length > 1"
                                                    style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);"
                                                >
                                                    Âà†Èô§
                                                </el-button>
                                            </div>

                                            <!-- Êìç‰ΩúÊåâÈíÆ -->
                                            <div style="text-align: center; margin-top: 20px;">
                                                <el-button
                                                    type="success"
                                                    size="default"
                                                    @click="addTaskGiftCardInput(task.id)"
                                                    :disabled="getTaskGiftCardInputs(task.id).length >= 8"
                                                    style="margin-right: 10px; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3);"
                                                >
                                                    ‚ûï Ê∑ªÂä†Á§ºÂìÅÂç° ({{ getTaskGiftCardInputs(task.id).length }}/8)
                                                </el-button>

                                                <el-button
                                                    type="primary"
                                                    size="default"
                                                    @click="submitTaskGiftCards(task.id)"
                                                    :loading="task.submittingGiftCards"
                                                    :disabled="!hasValidTaskGiftCards(task.id)"
                                                    style="margin-right: 10px; background: #4CAF50; border: 2px solid #45a049;"
                                                >
                                                    üöÄ Á°ÆËÆ§Êèê‰∫§ ({{ getValidTaskGiftCardCount(task.id) }}Âº†)
                                                </el-button>

                                                <el-button
                                                    type="info"
                                                    size="default"
                                                    @click="cancelTaskGiftCardInput(task.id)"
                                                    :disabled="task.submittingGiftCards"
                                                    style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);"
                                                >
                                                    ‚ùå ÂèñÊ∂à‰ªªÂä°
                                                </el-button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Á§ºÂìÅÂç°ÈîôËØØ‰ø°ÊÅØÊòæÁ§∫ -->
                                    <div v-if="task.gift_card_errors && task.gift_card_errors.length > 0" class="gift-card-errors">
                                        <div class="error-header">
                                            <span style="color: #f56c6c; margin-right: 8px;">‚ö†Ô∏è</span>
                                            <span>Á§ºÂìÅÂç°Áä∂ÊÄÅÂºÇÂ∏∏</span>
                                        </div>
                                        <div class="error-list">
                                            <div 
                                                v-for="error in task.gift_card_errors" 
                                                :key="error.card_number"
                                                class="error-item"
                                            >
                                                <el-tag type="danger" size="small">
                                                    {{ error.card_number }}
                                                </el-tag>
                                                <span class="error-message">{{ error.message }}</span>
                                                <el-tag :type="getGiftCardErrorType(error.status)" size="small">
                                                    {{ error.status }}
                                                </el-tag>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ÊúÄÊñ∞Êó•ÂøóÊòæÁ§∫ -->
                                    <div v-if="task.logs && task.logs.length > 0" class="latest-log">
                                        <p class="log-text">
                                            <span style="margin-right: 8px;">‚ÑπÔ∏è</span>
                                            {{ getLatestLog(task) }}
                                        </p>
                                    </div>
                                </div>

                                <div class="task-actions">
                                    <el-button
                                        v-if="task.status === 'pending'"
                                        type="primary"
                                        size="small"
                                        @click="startTask(task.id)"
                                    >
                                        ÂêØÂä®
                                    </el-button>
                                    <el-button
                                        v-if="task.status === 'running'"
                                        type="warning"
                                        size="small"
                                        @click="cancelTask(task.id)"
                                    >
                                        ÊöÇÂÅú
                                    </el-button>
                                    <el-button
                                        v-if="['completed', 'failed', 'cancelled'].includes(task.status)"
                                        type="success"
                                        size="small"
                                        @click="rerunTask(task)"
                                        :loading="task.rerunning"
                                    >
                                        ÈáçÊñ∞ËøêË°å
                                    </el-button>
                                    <el-button
                                        size="small"
                                        @click="viewTaskDetail(task)"
                                    >
                                        ËØ¶ÊÉÖ
                                    </el-button>
                                    <el-button
                                        type="danger"
                                        size="small"
                                        @click="deleteTask(task.id)"
                                    >
                                        Âà†Èô§
                                    </el-button>
                                </div>
                            </el-card>

                            <!-- Á©∫Áä∂ÊÄÅ -->
                            <el-empty
                                v-if="getTasksByProduct('iphone').length === 0"
                                description="ÊöÇÊó† iPhone ‰ªªÂä°"
                                :image-size="100"
                            >
                                <el-button type="primary" @click="openCreateDialog('iphone')">
                                    ÂàõÂª∫Á¨¨‰∏Ä‰∏™ iPhone ‰ªªÂä°
                                </el-button>
                            </el-empty>
                        </div>
                    </div>

                    <!-- Mac ‰∫ßÂìÅÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'mac'" class="product-section">
                        <div class="section-header">
                            <h2>üíª Mac Ëá™Âä®Âåñ‰ªªÂä°</h2>
                            <el-button
                                type="primary"
                                @click="openCreateDialog('mac')"
                            >
                                ÂàõÂª∫ Mac ‰ªªÂä°
                            </el-button>
                        </div>

                        <el-alert
                            title="Mac ‰∫ßÂìÅÊîØÊåÅÂç≥Â∞Ü‰∏äÁ∫ø"
                            type="info"
                            description="Mac ‰∫ßÂìÅÁöÑËá™Âä®ÂåñË¥≠‰π∞ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ"
                            show-icon
                            :closable="false"
                        ></el-alert>
                    </div>

                    <!-- iPad ‰∫ßÂìÅÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'ipad'" class="product-section">
                        <div class="section-header">
                            <h2>üì± iPad Ëá™Âä®Âåñ‰ªªÂä°</h2>
                            <el-button
                                type="primary"
                                @click="openCreateDialog('ipad')"
                            >
                                ÂàõÂª∫ iPad ‰ªªÂä°
                            </el-button>
                        </div>

                        <el-alert
                            title="iPad ‰∫ßÂìÅÊîØÊåÅÂç≥Â∞Ü‰∏äÁ∫ø"
                            type="info"
                            description="iPad ‰∫ßÂìÅÁöÑËá™Âä®ÂåñË¥≠‰π∞ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ"
                            show-icon
                            :closable="false"
                        ></el-alert>
                    </div>

                    <!-- Apple Watch ‰∫ßÂìÅÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'watch'" class="product-section">
                        <div class="section-header">
                            <h2>‚åö Apple Watch Ëá™Âä®Âåñ‰ªªÂä°</h2>
                            <el-button
                                type="primary"
                                @click="openCreateDialog('watch')"
                            >
                                ÂàõÂª∫ Watch ‰ªªÂä°
                            </el-button>
                        </div>

                        <el-alert
                            title="Apple Watch ‰∫ßÂìÅÊîØÊåÅÂç≥Â∞Ü‰∏äÁ∫ø"
                            type="info"
                            description="Apple Watch ‰∫ßÂìÅÁöÑËá™Âä®ÂåñË¥≠‰π∞ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ"
                            show-icon
                            :closable="false"
                        ></el-alert>
                    </div>

                    <!-- ÊâÄÊúâ‰ªªÂä°ËßÜÂõæ -->
                    <div v-if="currentProduct === 'all-tasks'" class="product-section">
                        <div class="section-header">
                            <h2>üìã ÊâÄÊúâ‰ªªÂä°ÊÄªËßà</h2>
                            <div class="header-stats">
                                <el-statistic title="ÊÄª‰ªªÂä°Êï∞" :value="tasks.length"></el-statistic>
                                <el-statistic title="ËøêË°å‰∏≠" :value="getTasksByStatus('running').length"></el-statistic>
                                <el-statistic title="Â∑≤ÂÆåÊàê" :value="getTasksByStatus('completed').length"></el-statistic>
                            </div>
                        </div>

                        <el-table :data="tasks" style="width: 100%" stripe>
                            <el-table-column prop="config.name" label="‰ªªÂä°ÂêçÁß∞" min-width="200"></el-table-column>
                            <el-table-column label="Apple ID" width="200">
                                <template #default="scope">
                                    <span style="color: #606266;">{{ scope.row.config.account_config?.email || 'N/A' }}</span>
                                </template>
                            </el-table-column>
                            <el-table-column label="‰∫ßÂìÅÁ±ªÂûã" width="120">
                                <template #default="scope">
                                    <el-tag>{{ getProductType(scope.row) }}</el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="Áä∂ÊÄÅ" width="120">
                                <template #default="scope">
                                    <el-tag :type="getStatusType(scope.row.status)">
                                        {{ getStatusText(scope.row.status) }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="ËøõÂ∫¶" width="250">
                                <template #default="scope">
                                    <div class="progress-cell">
                                        <el-progress
                                            :percentage="Math.round(scope.row.progress || 0)"
                                            :status="scope.row.status === 'completed' ? 'success' :
                                                    scope.row.status === 'failed' ? 'exception' : ''"
                                            :stroke-width="8"
                                            :show-text="true"
                                        ></el-progress>
                                        <div v-if="scope.row.status === 'running' && scope.row.current_step" class="current-step-mini">
                                            <el-tag type="primary" size="small" style="margin-top: 4px;">
                                                {{ formatStepName(scope.row.current_step) }}
                                            </el-tag>
                                        </div>
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column label="ÂàõÂª∫Êó∂Èó¥" width="180">
                                <template #default="scope">
                                    {{ formatTime(scope.row.created_at) }}
                                </template>
                            </el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="250" fixed="right">
                                <template #default="scope">
                                    <el-button-group size="small">
                                        <el-button
                                            v-if="scope.row.status === 'pending'"
                                            type="primary"
                                            @click="startTask(scope.row.id)"
                                        >
                                            ÂêØÂä®
                                        </el-button>
                                        <el-button
                                            v-if="scope.row.status === 'running'"
                                            type="warning"
                                            @click="cancelTask(scope.row.id)"
                                        >
                                            ÊöÇÂÅú
                                        </el-button>
                                        <el-button
                                            @click="viewTaskDetail(scope.row)"
                                        >
                                            ËØ¶ÊÉÖ
                                        </el-button>
                                        <el-button
                                            type="danger"
                                            @click="deleteTask(scope.row.id)"
                                        >
                                            Âà†Èô§
                                        </el-button>
                                    </el-button-group>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>

                    <!-- Ë¥¶Âè∑ÁÆ°ÁêÜÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'accounts'" class="product-section">
                        <div class="section-header">
                            <h2>üë§ Ë¥¶Âè∑ÁÆ°ÁêÜ</h2>
                            <div class="header-actions">
                                <el-button
                                    type="primary"
                                    @click="showCreateAccountDialog = true"
                                >
                                    Ê∑ªÂä†Ë¥¶Âè∑
                                </el-button>
                            </div>
                        </div>

                        <el-table :data="accounts" style="width: 100%" stripe>
                            <el-table-column prop="email" label="ÈÇÆÁÆ±" min-width="200"></el-table-column>
                            <el-table-column prop="phone_number" label="ÁîµËØùÂè∑Á†Å" width="180">
                                <template #default="scope">
                                    {{ scope.row.phone_number || '07700900000' }}
                                </template>
                            </el-table-column>
                            <el-table-column label="ÂàõÂª∫Êó∂Èó¥" width="180">
                                <template #default="scope">
                                    {{ formatTime(scope.row.created_at) }}
                                </template>
                            </el-table-column>
                            <el-table-column label="Áä∂ÊÄÅ" width="100">
                                <template #default="scope">
                                    <el-tag :type="scope.row.is_active ? 'success' : 'danger'">
                                        {{ scope.row.is_active ? 'Ê¥ªË∑É' : 'Á¶ÅÁî®' }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
                                <template #default="scope">
                                    <el-button-group size="small">
                                        <el-button
                                            @click="editAccount(scope.row)"
                                        >
                                            ÁºñËæë
                                        </el-button>
                                        <el-button
                                            type="danger"
                                            @click="deleteAccount(scope.row.id)"
                                        >
                                            Âà†Èô§
                                        </el-button>
                                    </el-button-group>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>



                    <!-- Á§ºÂìÅÂç°ÁÆ°ÁêÜÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'gift-cards'" class="product-section">
                        <div class="section-header">
                            <h2>üéÅ Á§ºÂìÅÂç°ÁÆ°ÁêÜ</h2>
                            <div class="header-actions">
                                <el-select
                                    v-model="giftCardStatusFilter"
                                    placeholder="Á≠õÈÄâÁä∂ÊÄÅ"
                                    clearable
                                    @change="loadGiftCards"
                                    style="width: 150px; margin-right: 10px;"
                                >
                                    <el-option
                                        v-for="status in giftCardStatuses"
                                        :key="status"
                                        :label="status"
                                        :value="status"
                                    ></el-option>
                                </el-select>
                                <el-button
                                    type="primary"
                                    @click="showCreateGiftCardDialog = true"
                                >
                                    Ê∑ªÂä†Á§ºÂìÅÂç°
                                </el-button>
                            </div>
                        </div>

                        <el-table :data="giftCards" style="width: 100%" stripe>
                            <el-table-column prop="gift_card_number" label="Á§ºÂìÅÂç°Âè∑" min-width="200"></el-table-column>
                            <el-table-column label="Áä∂ÊÄÅ" width="120">
                                <template #default="scope">
                                    <el-tag :type="getGiftCardStatusType(scope.row.status)">
                                        {{ scope.row.status }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="notes" label="Â§áÊ≥®" min-width="150"></el-table-column>
                            <el-table-column label="ÂàõÂª∫Êó∂Èó¥" width="180">
                                <template #default="scope">
                                    {{ formatTime(scope.row.created_at) }}
                                </template>
                            </el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
                                <template #default="scope">
                                    <el-button-group size="small">
                                        <el-button
                                            @click="editGiftCard(scope.row)"
                                        >
                                            ÁºñËæë
                                        </el-button>
                                        <el-button
                                            type="danger"
                                            @click="deleteGiftCard(scope.row.id)"
                                        >
                                            Âà†Èô§
                                        </el-button>
                                    </el-button-group>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>

                    <!-- IPÊ±†ÁÆ°ÁêÜÈ°µÈù¢ -->
                    <div v-if="currentProduct === 'ip-pool'" class="product-section">
                        <div class="section-header">
                            <h2>üåê IPÊ±†ÁÆ°ÁêÜ</h2>
                            <div class="header-actions">
                                <el-badge :value="ipStatus.proxy_pool?.available || 0" type="success">
                                    <el-button size="small" disabled>
                                        ÂèØÁî®‰ª£ÁêÜ
                                    </el-button>
                                </el-badge>
                                <el-badge :value="ipStatus.proxy_pool?.blocked_ips || 0" type="danger">
                                    <el-button size="small" disabled>
                                        Ë¢´Â∞ÅIP
                                    </el-button>
                                </el-badge>
                                <el-button
                                    type="primary"
                                    @click="showAddProxyDialog = true"
                                    size="small"
                                >
                                    Ê∑ªÂä†‰ª£ÁêÜ
                                </el-button>
                                <el-button
                                    type="success"
                                    @click="showProxyApiDialog = true"
                                    size="small"
                                >
                                    ÈÖçÁΩÆAPI
                                </el-button>
                                <el-button
                                    type="warning"
                                    @click="rotateIpManually"
                                    size="small"
                                    :loading="rotatingIp"
                                >
                                    ÊâãÂä®ËΩÆÊç¢
                                </el-button>
                                <el-button
                                    @click="refreshIpStatus"
                                    size="small"
                                    :loading="loadingIpStatus"
                                >
                                    Âà∑Êñ∞Áä∂ÊÄÅ
                                </el-button>
                            </div>
                        </div>

                        <!-- IPÁä∂ÊÄÅÊ¶ÇËßà -->
                        <el-row :gutter="20" style="margin-bottom: 20px;">
                            <el-col :span="6">
                                <el-card class="status-card">
                                    <div class="status-item">
                                        <div class="status-icon">üåê</div>
                                        <div class="status-content">
                                            <div class="status-title">ÂΩìÂâçIP</div>
                                            <div class="status-value">
                                                {{ ipStatus.current_ip?.using_proxy ? 
                                                   `${ipStatus.current_ip.proxy_host}:${ipStatus.current_ip.proxy_port}` : 
                                                   (ipStatus.current_ip?.ip || 'Êú™Áü•') }}
                                            </div>
                                            <div class="status-desc">
                                                {{ ipStatus.current_ip?.country || 'Êú™Áü•Âú∞Âå∫' }}
                                            </div>
                                        </div>
                                    </div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="status-card">
                                    <div class="status-item">
                                        <div class="status-icon">üìä</div>
                                        <div class="status-content">
                                            <div class="status-title">‰ª£ÁêÜÊ±†ÊÄªÊï∞</div>
                                            <div class="status-value">{{ ipStatus.proxy_pool?.total || 0 }}</div>
                                            <div class="status-desc">
                                                ÂèØÁî®: {{ ipStatus.proxy_pool?.available || 0 }}
                                            </div>
                                        </div>
                                    </div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="status-card">
                                    <div class="status-item">
                                        <div class="status-icon">üéÅ</div>
                                        <div class="status-content">
                                            <div class="status-title">Á§ºÂìÅÂç°Ë∑üË∏™</div>
                                            <div class="status-value">{{ ipStatus.proxy_pool?.gift_cards_tracked || 0 }}</div>
                                            <div class="status-desc">Âº†Á§ºÂìÅÂç°</div>
                                        </div>
                                    </div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="status-card">
                                    <div class="status-item">
                                        <div class="status-icon">‚öôÔ∏è</div>
                                        <div class="status-content">
                                            <div class="status-title">ËΩÆÊç¢Áä∂ÊÄÅ</div>
                                            <div class="status-value">
                                                {{ ipStatus.rotation_enabled ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®' }}
                                            </div>
                                            <div class="status-desc">
                                                Á§ºÂìÅÂç°: {{ ipStatus.gift_card_rotation_enabled ? 'ÂêØÁî®' : 'Á¶ÅÁî®' }}
                                            </div>
                                        </div>
                                    </div>
                                </el-card>
                            </el-col>
                        </el-row>

                        <!-- IPÊ±†ËÆæÁΩÆ -->
                        <el-card style="margin-bottom: 20px;">
                            <template #header>
                                <span>IPÊ±†ËÆæÁΩÆ</span>
                            </template>
                            <el-form :model="ipSettings" label-width="150px" size="small">
                                <el-row :gutter="20">
                                    <el-col :span="12">
                                        <el-form-item label="ÂêØÁî®IPËΩÆÊç¢">
                                            <el-switch
                                                v-model="ipSettings.rotation_enabled"
                                                @change="updateIpSettings"
                                            ></el-switch>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="12">
                                        <el-form-item label="Á§ºÂìÅÂç°‰∏ìÁî®ËΩÆÊç¢">
                                            <el-switch
                                                v-model="ipSettings.gift_card_rotation_enabled"
                                                @change="updateIpSettings"
                                            ></el-switch>
                                        </el-form-item>
                                    </el-col>
                                </el-row>
                                <el-row :gutter="20">
                                    <el-col :span="12">
                                        <el-form-item label="ÊØèIPÊúÄÂ§ßÁ§ºÂìÅÂç°Êï∞">
                                            <el-input-number
                                                v-model="ipSettings.max_gift_card_per_ip"
                                                :min="1"
                                                :max="10"
                                                @change="updateIpSettings"
                                            ></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="12">
                                        <el-form-item label="ËΩÆÊç¢Èó¥Èöî(Áßí)">
                                            <el-input-number
                                                v-model="ipSettings.rotation_interval"
                                                :min="60"
                                                :max="3600"
                                                @change="updateIpSettings"
                                            ></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                </el-row>
                            </el-form>
                        </el-card>

                        <!-- ‰ª£ÁêÜÂàóË°® -->
                        <el-table :data="proxyList" style="width: 100%" stripe>
                            <el-table-column prop="host" label="‰∏ªÊú∫" min-width="150"></el-table-column>
                            <el-table-column prop="port" label="Á´ØÂè£" width="80"></el-table-column>
                            <el-table-column prop="country" label="ÂõΩÂÆ∂" width="100"></el-table-column>
                            <el-table-column label="Áä∂ÊÄÅ" width="100">
                                <template #default="scope">
                                    <el-tag :type="getProxyStatusType(scope.row.status)">
                                        {{ scope.row.status }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="ÊàêÂäüÁéá" width="100">
                                <template #default="scope">
                                    <el-progress
                                        :percentage="Math.round(scope.row.success_rate * 100)"
                                        :color="getSuccessRateColor(scope.row.success_rate)"
                                        :show-text="false"
                                        style="width: 60px;"
                                    ></el-progress>
                                    <span style="margin-left: 8px; font-size: 12px;">
                                        {{ Math.round(scope.row.success_rate * 100) }}%
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column prop="response_time" label="ÂìçÂ∫îÊó∂Èó¥(s)" width="120">
                                <template #default="scope">
                                    {{ scope.row.response_time?.toFixed(2) || '-' }}
                                </template>
                            </el-table-column>
                            <el-table-column label="ÊúÄÂêé‰ΩøÁî®" width="160">
                                <template #default="scope">
                                    {{ scope.row.last_used ? formatTime(scope.row.last_used) : 'Êú™‰ΩøÁî®' }}
                                </template>
                            </el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
                                <template #default="scope">
                                    <el-button-group size="small">
                                        <el-button
                                            type="primary"
                                            @click="testProxy(scope.row)"
                                            :loading="testingProxy === scope.row.host"
                                        >
                                            ÊµãËØï
                                        </el-button>
                                        <el-button
                                            type="warning"
                                            @click="blockProxy(scope.row)"
                                            v-if="scope.row.status !== 'blocked'"
                                        >
                                            Â∞ÅÁ¶Å
                                        </el-button>
                                        <el-button
                                            type="success"
                                            @click="unblockProxy(scope.row)"
                                            v-else
                                        >
                                            Ëß£Â∞Å
                                        </el-button>
                                        <el-button
                                            type="danger"
                                            @click="removeProxy(scope.row)"
                                        >
                                            Âà†Èô§
                                        </el-button>
                                    </el-button-group>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </el-main>
            </el-container>
        </el-container>

        <!-- ÂàõÂª∫‰ªªÂä°ÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showCreateDialog"
            :title="`ÂàõÂª∫ ${currentProductType} ‰ªªÂä°`"
            width="700px"
            :close-on-click-modal="false"
        >
            <el-form :model="taskForm" label-width="120px" :rules="taskRules" ref="taskFormRef">
                <el-form-item label="‰ªªÂä°ÂêçÁß∞" prop="name">
                    <el-input
                        v-model="taskForm.name"
                        placeholder="ËØ∑ËæìÂÖ•‰ªªÂä°ÂêçÁß∞"
                        clearable
                    />
                </el-form-item>

                <el-form-item label="‰∫ßÂìÅURL" prop="url">
                    <el-input
                        v-model="taskForm.url"
                        placeholder="Á≤òË¥¥iPhone URLËá™Âä®Ëß£ÊûêÈÖçÁΩÆÔºåÊàñÈÄöËøá‰∏ãÊñπÈÄâÊã©ÁîüÊàê"
                        type="textarea"
                        :rows="2"
                        clearable
                        @blur="parseUrlIfNeeded"
                    >
                        <template #append>
                            <el-button @click="parseUrl" type="primary" :loading="parsingUrl">
                                Ëß£Êûê
                            </el-button>
                        </template>
                    </el-input>
                    <div class="url-hint" v-if="taskForm.url && !isValidUrl">
                        <el-text type="warning" size="small">
                            ‚ö†Ô∏è URLÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåËØ∑Ê£ÄÊü•Êàñ‰ΩøÁî®‰∏ãÊñπÈÖçÁΩÆÈÄâÊã©
                        </el-text>
                    </div>
                </el-form-item>

                <!-- Apple Ë¥¶Âè∑‰ø°ÊÅØ -->
                <el-divider content-position="left">
                    <span style="color: #909399; font-size: 14px;">üçé Apple Ë¥¶Âè∑‰ø°ÊÅØ</span>
                </el-divider>

                <el-form-item label="ÈÄâÊã©Ë¥¶Âè∑" prop="selectedAccount">
                    <el-select
                        v-model="taskForm.selectedAccount"
                        placeholder="ËØ∑ÈÄâÊã©Apple IDË¥¶Âè∑"
                        style="width: 100%"
                        @change="onAccountChange"
                        clearable
                    >
                        <el-option
                            v-for="account in accounts"
                            :key="account.id"
                            :label="account.email"
                            :value="account.id"
                        >
                            <span>{{ account.email }}</span>
                            <span style="float: right; color: #8492a6; font-size: 13px;">
                                {{ formatTime(account.created_at) }}
                            </span>
                        </el-option>
                    </el-select>
                    <div style="margin-top: 8px;">
                        <el-link type="primary" @click="switchProduct('accounts')" style="font-size: 12px;">
                            üìù ÁÆ°ÁêÜË¥¶Âè∑
                        </el-link>
                    </div>
                </el-form-item>

                <!-- ‰∫ßÂìÅÈÖçÁΩÆ -->
                <el-divider content-position="left">
                    <span style="color: #909399; font-size: 14px;">üì± ‰∫ßÂìÅÈÖçÁΩÆ</span>
                </el-divider>

                <!-- iPhone ÁâπÂÆöÈÖçÁΩÆ -->
                <template v-if="currentProductType === 'iPhone'">


                    <el-form-item label="‰∫ßÂìÅÂûãÂè∑" prop="selectedModel">
                        <el-select
                            v-model="taskForm.selectedModel"
                            placeholder="ÈÄâÊã©iPhoneÂûãÂè∑"
                            style="width: 100%"
                            @change="onModelChange"
                        >
                            <el-option
                                v-for="(modelData, modelKey) in iphoneConfigs.models"
                                :key="modelKey"
                                :label="modelData.name"
                                :value="modelKey"
                            ></el-option>
                        </el-select>
                    </el-form-item>

                    <el-form-item label="Â∞∫ÂØ∏" prop="selectedSize" v-if="taskForm.selectedModel">
                        <el-select
                            v-model="taskForm.selectedSize"
                            placeholder="ÈÄâÊã©Â∞∫ÂØ∏"
                            style="width: 100%"
                            @change="onSizeChange"
                        >
                            <el-option
                                v-for="(sizeData, sizeKey) in availableSizes"
                                :key="sizeKey"
                                :label="sizeData.name"
                                :value="sizeKey"
                            ></el-option>
                        </el-select>
                    </el-form-item>

                    <el-form-item label="Â≠òÂÇ®ÂÆπÈáè" prop="selectedStorage" v-if="taskForm.selectedSize">
                        <el-select
                            v-model="taskForm.selectedStorage"
                            placeholder="ÈÄâÊã©ÂÆπÈáè"
                            style="width: 100%"
                            @change="onStorageChange"
                        >
                            <el-option
                                v-for="storage in availableStorages"
                                :key="storage"
                                :label="iphoneConfigs.storage_display_names[storage]"
                                :value="storage"
                            ></el-option>
                        </el-select>
                    </el-form-item>

                    <el-form-item label="È¢úËâ≤" prop="selectedColor" v-if="taskForm.selectedStorage">
                        <el-select
                            v-model="taskForm.selectedColor"
                            placeholder="ÈÄâÊã©È¢úËâ≤"
                            style="width: 100%"
                            @change="onColorChange"
                        >
                            <el-option
                                v-for="color in availableColors"
                                :key="color"
                                :label="iphoneConfigs.color_display_names[color]"
                                :value="color"
                            ></el-option>
                        </el-select>
                    </el-form-item>

                    <!-- ÁîüÊàêÁöÑURLÊòæÁ§∫ -->
                    <el-form-item label="‰∫ßÂìÅURL" v-if="generatedUrl">
                        <el-input
                            v-model="generatedUrl"
                            readonly
                            type="textarea"
                            :rows="2"
                        >
                            <template #append>
                                <el-button @click="copyUrl" type="primary">Â§çÂà∂</el-button>
                            </template>
                        </el-input>
                    </el-form-item>
                </template>

                <!-- ÈÄöÁî®ÈÖçÁΩÆ -->
                <el-form-item label="‰ºòÂÖàÁ∫ß">
                    <el-select v-model="taskForm.priority" style="width: 100%">
                        <el-option label="‰Ωé" :value="1"></el-option>
                        <el-option label="‰∏≠" :value="2"></el-option>
                        <el-option label="È´ò" :value="3"></el-option>
                    </el-select>
                </el-form-item>

                <el-form-item label="Á§ºÂìÅÂç°ÈÖçÁΩÆ">
                    <el-alert
                        title="üéÅ Á§ºÂìÅÂç°Â∞ÜÂú®‰ªªÂä°ËøêË°åÊó∂Âä®ÊÄÅËæìÂÖ•"
                        type="info"
                        show-icon
                        :closable="false"
                        description="‰ªªÂä°ÊâßË°åÂà∞‰ªòÊ¨æÈ°µÈù¢Êó∂ÔºåÁ≥ªÁªü‰ºöËá™Âä®ÊöÇÂÅúÂπ∂ÊòæÁ§∫Á§ºÂìÅÂç°ËæìÂÖ•ÁïåÈù¢ÔºåÊÇ®ÂèØ‰ª•Âú®ÈÇ£Êó∂ËæìÂÖ•ÊúÄÂ§ö8Âº†Á§ºÂìÅÂç°„ÄÇ"
                    />
                </el-form-item>
            </el-form>

            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="closeCreateDialog">ÂèñÊ∂à</el-button>
                    <el-button type="primary" @click="createTask" :loading="creating">
                        ÂàõÂª∫‰ªªÂä°
                    </el-button>
                </div>
            </template>
        </el-dialog>

        <!-- ‰ªªÂä°ËØ¶ÊÉÖÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showDetailDialog"
            title="‰ªªÂä°ËØ¶ÊÉÖ"
            width="800px"
        >
            <div v-if="selectedTask">
                <el-descriptions :column="2" border>
                    <el-descriptions-item label="‰ªªÂä°ÂêçÁß∞">{{ selectedTask.config.name }}</el-descriptions-item>
                    <el-descriptions-item label="Áä∂ÊÄÅ">
                        <el-tag :type="getStatusType(selectedTask.status)">
                            {{ getStatusText(selectedTask.status) }}
                        </el-tag>
                    </el-descriptions-item>
                    <el-descriptions-item label="Apple ID">{{ selectedTask.config.account_config?.email || 'N/A' }}</el-descriptions-item>
                    <el-descriptions-item label="ËøõÂ∫¶">{{ selectedTask.progress }}%</el-descriptions-item>
                    <el-descriptions-item label="ÂàõÂª∫Êó∂Èó¥" span="2">{{ formatTime(selectedTask.created_at) }}</el-descriptions-item>
                    <el-descriptions-item label="‰∫ßÂìÅURL" span="2">
                        <el-link :href="selectedTask.config.url" target="_blank">
                            {{ selectedTask.config.url }}
                        </el-link>
                    </el-descriptions-item>
                </el-descriptions>

                <div style="margin-top: 20px;">
                    <h4>ËøêË°åÊó•Âøó</h4>
                    <div class="log-container">
                        <div
                            v-if="selectedTask.logs && selectedTask.logs.length > 0"
                            class="log-entries"
                        >
                            <div
                                v-for="(log, index) in selectedTask.logs"
                                :key="index"
                                class="log-entry"
                                :class="log.level || 'info'"
                            >
                                <span class="log-time">{{ formatTime(log.timestamp) }}</span>
                                <span class="log-message">{{ log.message }}</span>
                            </div>
                        </div>
                        <div v-else class="no-logs">
                            ÊöÇÊó†Êó•Âøó‰ø°ÊÅØ
                        </div>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- Á≥ªÁªüÊó•ÂøóÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showSystemLogsDialog"
            title="Á≥ªÁªüËøêË°åÊó•Âøó"
            width="900px"
            :close-on-click-modal="false"
        >
            <div class="system-logs-container">
                <div class="logs-header">
                    <el-button @click="systemLogs = []" type="danger" size="small">
                        Ê∏ÖÁ©∫Êó•Âøó
                    </el-button>
                    <el-text type="info" size="small">
                        ÊòæÁ§∫ÊúÄËøë {{ systemLogs.length }} Êù°Êó•Âøó
                    </el-text>
                </div>

                <div class="log-container" style="height: 400px;">
                    <div
                        v-if="systemLogs.length > 0"
                        class="log-entries"
                    >
                        <div
                            v-for="(log, index) in systemLogs"
                            :key="index"
                            class="log-entry"
                            :class="log.level"
                        >
                            <span class="log-time">{{ formatTime(log.timestamp) }}</span>
                            <span class="log-message">{{ log.message }}</span>
                        </div>
                    </div>
                    <div v-else class="no-logs">
                        ÊöÇÊó†Á≥ªÁªüÊó•Âøó
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- ÂàõÂª∫Ë¥¶Âè∑ÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showCreateAccountDialog"
            title="Ê∑ªÂä†Ë¥¶Âè∑"
            width="500px"
            :close-on-click-modal="false"
        >
            <el-form :model="accountForm" label-width="100px" :rules="accountRules" ref="accountFormRef">
                <el-form-item label="ÈÇÆÁÆ±" prop="email">
                    <el-input
                        v-model="accountForm.email"
                        placeholder="ËØ∑ËæìÂÖ•Apple IDÈÇÆÁÆ±"
                        clearable
                    />
                </el-form-item>

                <el-form-item label="ÂØÜÁ†Å" prop="password">
                    <el-input
                        v-model="accountForm.password"
                        placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å"
                        type="password"
                        show-password
                        clearable
                    />
                </el-form-item>

                <el-form-item label="ÁîµËØùÂè∑Á†Å" prop="phone_number">
                    <el-input
                        v-model="accountForm.phone_number"
                        placeholder="ËØ∑ËæìÂÖ•Ëã±ÂõΩÊâãÊú∫Âè∑Á†Å (Â¶Ç: 07700900000)"
                        clearable
                    />
                    <div style="margin-top: 5px; text-align: right;">
                        <el-text size="small" type="info">
                            ËØ∑ËæìÂÖ•Ëã±ÂõΩÊâãÊú∫Âè∑Á†ÅÊ†ºÂºèÔºå‰ª•07ÂºÄÂ§¥ÁöÑ11‰ΩçÊï∞Â≠ó
                        </el-text>
                    </div>
                </el-form-item>
            </el-form>

            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="closeAccountDialog">ÂèñÊ∂à</el-button>
                    <el-button type="primary" @click="saveAccount" :loading="savingAccount">
                        {{ editingAccount ? 'Êõ¥Êñ∞' : 'ÂàõÂª∫' }}
                    </el-button>
                </div>
            </template>
        </el-dialog>

        <!-- ÂàõÂª∫Á§ºÂìÅÂç°ÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showCreateGiftCardDialog"
            title="Ê∑ªÂä†Á§ºÂìÅÂç°"
            width="500px"
            :close-on-click-modal="false"
        >
            <el-form :model="giftCardForm" label-width="100px" :rules="giftCardRules" ref="giftCardFormRef">
                <el-form-item label="Á§ºÂìÅÂç°Âè∑" prop="gift_card_number">
                    <el-input
                        v-model="giftCardForm.gift_card_number"
                        placeholder="ËØ∑ËæìÂÖ•Á§ºÂìÅÂç°Âè∑"
                        clearable
                    />
                </el-form-item>

                <el-form-item label="Áä∂ÊÄÅ" prop="status">
                    <el-select v-model="giftCardForm.status" style="width: 100%">
                        <el-option
                            v-for="status in giftCardStatuses"
                            :key="status"
                            :label="status"
                            :value="status"
                        ></el-option>
                    </el-select>
                </el-form-item>

                <el-form-item label="Â§áÊ≥®">
                    <el-input
                        v-model="giftCardForm.notes"
                        placeholder="ÂèØÈÄâÂ§áÊ≥®‰ø°ÊÅØ"
                        type="textarea"
                        :rows="3"
                        clearable
                    />
                </el-form-item>
            </el-form>

            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="closeGiftCardDialog">ÂèñÊ∂à</el-button>
                    <el-button type="primary" @click="saveGiftCard" :loading="savingGiftCard">
                        {{ editingGiftCard ? 'Êõ¥Êñ∞' : 'ÂàõÂª∫' }}
                    </el-button>
                </div>
            </template>
        </el-dialog>

        <!-- Ê∑ªÂä†‰ª£ÁêÜÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showAddProxyDialog"
            title="Ê∑ªÂä†‰ª£ÁêÜÊúçÂä°Âô®"
            width="500px"
            :close-on-click-modal="false"
        >
            <el-form :model="proxyForm" label-width="100px" :rules="proxyRules" ref="proxyFormRef">
                <el-form-item label="‰∏ªÊú∫Âú∞ÂùÄ" prop="host">
                    <el-input
                        v-model="proxyForm.host"
                        placeholder="ËØ∑ËæìÂÖ•‰ª£ÁêÜ‰∏ªÊú∫Âú∞ÂùÄ"
                        clearable
                    />
                </el-form-item>
                <el-form-item label="Á´ØÂè£" prop="port">
                    <el-input-number
                        v-model="proxyForm.port"
                        :min="1"
                        :max="65535"
                        placeholder="Á´ØÂè£Âè∑"
                        style="width: 100%"
                    />
                </el-form-item>
                <el-form-item label="ÂçèËÆÆÁ±ªÂûã" prop="protocol">
                    <el-select v-model="proxyForm.protocol" style="width: 100%">
                        <el-option label="HTTP" value="http"></el-option>
                        <el-option label="HTTPS" value="https"></el-option>
                        <el-option label="SOCKS5" value="socks5"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="ÂõΩÂÆ∂/Âú∞Âå∫" prop="country">
                    <el-input
                        v-model="proxyForm.country"
                        placeholder="Â¶ÇÔºöUS, UK, CA"
                        clearable
                    />
                </el-form-item>
                <el-form-item label="Áî®Êà∑Âêç">
                    <el-input
                        v-model="proxyForm.username"
                        placeholder="‰ª£ÁêÜËÆ§ËØÅÁî®Êà∑ÂêçÔºàÂèØÈÄâÔºâ"
                        clearable
                    />
                </el-form-item>
                <el-form-item label="ÂØÜÁ†Å">
                    <el-input
                        v-model="proxyForm.password"
                        type="password"
                        placeholder="‰ª£ÁêÜËÆ§ËØÅÂØÜÁ†ÅÔºàÂèØÈÄâÔºâ"
                        show-password
                        clearable
                    />
                </el-form-item>
            </el-form>
            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="showAddProxyDialog = false">ÂèñÊ∂à</el-button>
                    <el-button
                        type="primary"
                        @click="addProxy"
                        :loading="addingProxy"
                    >
                        Ê∑ªÂä†‰ª£ÁêÜ
                    </el-button>
                </div>
            </template>
        </el-dialog>

        <!-- ‰ª£ÁêÜAPIÈÖçÁΩÆÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showProxyApiDialog"
            title="ÈÖçÁΩÆ‰ª£ÁêÜAPI"
            width="600px"
            :close-on-click-modal="false"
        >
            <el-form :model="apiForm" label-width="120px" :rules="apiRules" ref="apiFormRef">
                <el-form-item label="APIÁ±ªÂûã" prop="apiType">
                    <el-select v-model="apiForm.apiType" style="width: 100%" @change="onApiTypeChange">
                        <el-option label="Ëá™ÂÆö‰πâAPI" value="custom"></el-option>
                        <el-option label="ProxyMesh" value="proxymesh"></el-option>
                        <el-option label="Bright Data" value="brightdata"></el-option>
                        <el-option label="Oxylabs" value="oxylabs"></el-option>
                        <el-option label="SmartProxy" value="smartproxy"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="APIÂú∞ÂùÄ" prop="apiUrl">
                    <el-input
                        v-model="apiForm.apiUrl"
                        placeholder="‰ª£ÁêÜAPIÁöÑÂÆåÊï¥URLÂú∞ÂùÄ"
                        clearable
                    />
                    <div class="form-hint">
                        <span>Á§∫‰æã: https://your-proxy-api.com/api/proxies</span>
                    </div>
                </el-form-item>
                <el-form-item label="APIÂØÜÈí•" prop="apiKey">
                    <el-input
                        v-model="apiForm.apiKey"
                        type="password"
                        placeholder="APIËÆøÈóÆÂØÜÈí•"
                        show-password
                        clearable
                    />
                </el-form-item>
                <el-form-item label="ËØ∑Ê±ÇÂ§¥">
                    <el-input
                        v-model="apiForm.headers"
                        type="textarea"
                        :rows="3"
                        placeholder='Ëá™ÂÆö‰πâËØ∑Ê±ÇÂ§¥ÔºàJSONÊ†ºÂºèÔºâ‰æãÂ¶ÇÔºö{"Authorization": "Bearer token"}'
                        clearable
                    />
                </el-form-item>
                <el-form-item label="ÂêåÊ≠•Èó¥Èöî(ÂàÜÈíü)">
                    <el-input-number
                        v-model="apiForm.syncInterval"
                        :min="5"
                        :max="1440"
                        style="width: 100%"
                    />
                    <div class="form-hint">
                        <span>‰ªéAPIÂêåÊ≠•‰ª£ÁêÜÂàóË°®ÁöÑÈó¥ÈöîÊó∂Èó¥</span>
                    </div>
                </el-form-item>
                <el-form-item>
                    <el-button
                        type="success"
                        @click="testProxyApi"
                        :loading="testingApi"
                        size="small"
                    >
                        ÊµãËØïAPIËøûÊé•
                    </el-button>
                    <el-button
                        type="primary"
                        @click="syncProxiesFromApi"
                        :loading="syncingProxies"
                        size="small"
                    >
                        Á´ãÂç≥ÂêåÊ≠•‰ª£ÁêÜ
                    </el-button>
                </el-form-item>
            </el-form>
            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="showProxyApiDialog = false">ÂèñÊ∂à</el-button>
                    <el-button
                        type="primary"
                        @click="saveProxyApiConfig"
                        :loading="savingApiConfig"
                    >
                        ‰øùÂ≠òÈÖçÁΩÆ
                    </el-button>
                </div>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue
        const { ElMessage, ElMessageBox } = ElementPlus

        // ‰ªéElement Plus Icons‰∏≠Ëé∑ÂèñÂõæÊ†áÁªÑ‰ª∂
        // Ê£ÄÊü•ElementPlusIconsVueÊòØÂê¶ÂèØÁî®
        console.log('ElementPlusIconsVue:', typeof ElementPlusIconsVue)

        // Â¶ÇÊûúElementPlusIconsVue‰∏çÂèØÁî®ÔºåÂàõÂª∫Á©∫ÁöÑÂõæÊ†áÁªÑ‰ª∂
        const iconComponents = ElementPlusIconsVue || {}
        const WalletFilled = iconComponents.WalletFilled || { name: 'WalletFilled', render: () => Vue.h('span', 'üí≥') }
        const WarningFilled = iconComponents.WarningFilled || { name: 'WarningFilled', render: () => Vue.h('span', '‚ö†Ô∏è') }
        const InfoFilled = iconComponents.InfoFilled || { name: 'InfoFilled', render: () => Vue.h('span', '‚ÑπÔ∏è') }
        const Plus = iconComponents.Plus || { name: 'Plus', render: () => Vue.h('span', '‚ûï') }
        const Delete = iconComponents.Delete || { name: 'Delete', render: () => Vue.h('span', 'üóëÔ∏è') }
        const Edit = iconComponents.Edit || { name: 'Edit', render: () => Vue.h('span', '‚úèÔ∏è') }
        const Refresh = iconComponents.Refresh || { name: 'Refresh', render: () => Vue.h('span', 'üîÑ') }
        const Search = iconComponents.Search || { name: 'Search', render: () => Vue.h('span', 'üîç') }
        const Setting = iconComponents.Setting || { name: 'Setting', render: () => Vue.h('span', '‚öôÔ∏è') }

        const app = createApp({
            data() {
                return {
                    socket: null,
                    isConnected: false,
                    currentProduct: 'iphone',
                    currentProductType: 'iPhone',
                    showCreateDialog: false,
                    showDetailDialog: false,
                    creating: false,
                    tasks: [],
                    selectedTask: null,
                    presetAccounts: [], // ÁßªÈô§È¢ÑËÆæË¥¶Âè∑ÈÖçÁΩÆ
                    systemStatus: {
                        total_tasks: 0,
                        active_tasks: 0,
                        max_concurrent: 3
                    },

                    // ËΩÆËØ¢Áõ∏ÂÖ≥
                    pollingInterval: null,
                    pollingEnabled: true,
                    pollingFrequency: 100, // 100ms SOTAÈ´òÈ¢ëËΩÆËØ¢


                    
                    // WebSocketËøûÊé•Áä∂ÊÄÅÁÆ°ÁêÜ
                    connectionStatus: 'disconnected', // disconnected, connecting, connected
                    reconnectAttempts: 0,
                    maxReconnectAttempts: 5,
                    reconnectInterval: null,
                    taskForm: {
                        name: '',
                        url: '',
                        selectedAccount: null,
                        selectedGiftCards: [], // Êîπ‰∏∫Êï∞ÁªÑÊîØÊåÅÂ§öÂº†Á§ºÂìÅÂç°
                        selectedModel: '',
                        selectedSize: '',
                        selectedStorage: '',
                        selectedColor: '',
                        priority: 2
                    },
                    tempGiftCardSelection: null, // ‰∏¥Êó∂Á§ºÂìÅÂç°ÈÄâÊã©
                    iphoneConfigs: {
                        models: {},
                        color_display_names: {},
                        storage_display_names: {}
                    },
                    generatedUrl: '',
                    parsingUrl: false,
                    isValidUrl: true,
                    startingAllTasks: false,
                    systemLogs: [],
                    showSystemLogsDialog: false,

                    // Ë¥¶Âè∑ÁÆ°ÁêÜ
                    accounts: [],
                    showCreateAccountDialog: false,
                    editingAccount: null,
                    savingAccount: false,
                    accountForm: {
                        email: '',
                        password: '',
                        phone_number: '07700900000'
                    },
                    accountRules: {
                        email: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•ÈÇÆÁÆ±', trigger: 'blur' },
                            { type: 'email', message: 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÈÇÆÁÆ±Ê†ºÂºè', trigger: 'blur' }
                        ],
                        password: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•ÂØÜÁ†Å', trigger: 'blur' },
                            { min: 6, message: 'ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë6‰Ωç', trigger: 'blur' }
                        ],
                        phone_number: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•ÁîµËØùÂè∑Á†Å', trigger: 'blur' },
                            { pattern: /^07\d{9}$/, message: 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑËã±ÂõΩÊâãÊú∫Âè∑Á†ÅÊ†ºÂºè (07xxxxxxxxx)', trigger: 'blur' }
                        ]
                    },

                    // Á§ºÂìÅÂç°ÁÆ°ÁêÜ
                    giftCards: [],
                    giftCardStatuses: [],
                    giftCardStatusFilter: '',
                    showCreateGiftCardDialog: false,
                    editingGiftCard: null,
                    savingGiftCard: false,
                    giftCardForm: {
                        gift_card_number: '',
                        status: '',
                        notes: ''
                    },
                    giftCardRules: {
                        gift_card_number: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•Á§ºÂìÅÂç°Âè∑', trigger: 'blur' }
                        ],
                        status: [
                            { required: true, message: 'ËØ∑ÈÄâÊã©Áä∂ÊÄÅ', trigger: 'change' }
                        ]
                    },

                    // ‰ªªÂä°Á§ºÂìÅÂç°ËæìÂÖ•ÁÆ°ÁêÜ
                    taskGiftCardInputs: {}, // Ê†ºÂºè: { taskId: [{ number: '' }] }

                    // IPÊ±†ÁÆ°ÁêÜÁõ∏ÂÖ≥Êï∞ÊçÆ
                    ipStatus: {
                        current_ip: {},
                        proxy_pool: {},
                        rotation_enabled: false,
                        gift_card_rotation_enabled: false
                    },
                    ipSettings: {
                        rotation_enabled: false,
                        gift_card_rotation_enabled: false,
                        max_gift_card_per_ip: 2,
                        rotation_interval: 300
                    },
                    proxyList: [],
                    loadingIpStatus: false,
                    rotatingIp: false,
                    testingProxy: null,
                    
                    // Ê∑ªÂä†‰ª£ÁêÜÂØπËØùÊ°Ü
                    showAddProxyDialog: false,
                    addingProxy: false,
                    proxyForm: {
                        host: '',
                        port: null,
                        protocol: 'http',
                        country: '',
                        username: '',
                        password: ''
                    },
                    proxyRules: {
                        host: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•‰∏ªÊú∫Âú∞ÂùÄ', trigger: 'blur' },
                            { pattern: /^[a-zA-Z0-9.-]+$/, message: '‰∏ªÊú∫Âú∞ÂùÄÊ†ºÂºè‰∏çÊ≠£Á°Æ', trigger: 'blur' }
                        ],
                        port: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•Á´ØÂè£Âè∑', trigger: 'blur' },
                            { type: 'number', min: 1, max: 65535, message: 'Á´ØÂè£Âè∑ËåÉÂõ¥Ôºö1-65535', trigger: 'blur' }
                        ],
                        protocol: [
                            { required: true, message: 'ËØ∑ÈÄâÊã©ÂçèËÆÆÁ±ªÂûã', trigger: 'change' }
                        ],
                        country: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•ÂõΩÂÆ∂/Âú∞Âå∫‰ª£Á†Å', trigger: 'blur' }
                        ]
                    },
                    
                    // ‰ª£ÁêÜAPIÈÖçÁΩÆÂØπËØùÊ°Ü
                    showProxyApiDialog: false,
                    savingApiConfig: false,
                    testingApi: false,
                    syncingProxies: false,
                    apiForm: {
                        apiType: 'custom',
                        apiUrl: '',
                        apiKey: '',
                        headers: '',
                        syncInterval: 60
                    },
                    apiRules: {
                        apiUrl: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•APIÂú∞ÂùÄ', trigger: 'blur' },
                            { type: 'url', message: 'APIÂú∞ÂùÄÊ†ºÂºè‰∏çÊ≠£Á°Æ', trigger: 'blur' }
                        ],
                        apiKey: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•APIÂØÜÈí•', trigger: 'blur' }
                        ]
                    },
                    taskRules: {
                        name: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•‰ªªÂä°ÂêçÁß∞', trigger: 'blur' }
                        ],
                        url: [
                            { required: true, message: 'ËØ∑ËæìÂÖ•‰∫ßÂìÅURL', trigger: 'blur' }
                        ],
                        selectedAccount: [
                            { required: true, message: 'ËØ∑ÈÄâÊã©Apple IDË¥¶Âè∑', trigger: 'change' }
                        ],
                        selectedGiftCards: [
                            // üöÄ Á§ºÂìÅÂç°Áé∞Âú®ÊòØÂèØÈÄâÈ°π - Á≥ªÁªü‰ºöÂú®ËøêË°åÊó∂ÂºπÂá∫ÁïåÈù¢ËÆ©Áî®Êà∑ËæìÂÖ•
                        ]
                    }
                }
            },
            computed: {
                availableSizes() {
                    if (!this.taskForm.selectedModel || !this.iphoneConfigs.models[this.taskForm.selectedModel]) {
                        return {}
                    }
                    return this.iphoneConfigs.models[this.taskForm.selectedModel].sizes
                },

                availableStorages() {
                    if (!this.taskForm.selectedModel || !this.taskForm.selectedSize) {
                        return []
                    }
                    const sizeData = this.iphoneConfigs.models[this.taskForm.selectedModel]?.sizes[this.taskForm.selectedSize]
                    return sizeData?.storages || []
                },

                availableColors() {
                    if (!this.taskForm.selectedModel || !this.taskForm.selectedSize) {
                        return []
                    }
                    const sizeData = this.iphoneConfigs.models[this.taskForm.selectedModel]?.sizes[this.taskForm.selectedSize]
                    return sizeData?.colors || []
                },

                hasExecutableTasks() {
                    return this.tasks.some(task => task.status === 'pending')
                },

                pendingTasks() {
                    return this.tasks.filter(task => task.status === 'pending')
                },

                runningTasks() {
                    return this.tasks.filter(task => task.status === 'running')
                },

                availableGiftCards() {
                    // ÊòæÁ§∫ÊâÄÊúâÁ§ºÂìÅÂç°Ôºå‰∏çÁÆ°Áä∂ÊÄÅÂ¶Ç‰ΩïÔºàÂõ†‰∏∫ÂæàÂ§öÊó∂ÂÄôÊàë‰ª¨‰∏çÁü•ÈÅìÁ§ºÂìÅÂç°ÁöÑÁúüÂÆûÁä∂ÊÄÅÔºâ
                    return this.giftCards.filter(card => card.is_active)
                },
                
                availableGiftCardsToAdd() {
                    // ÂèØÊ∑ªÂä†ÁöÑÁ§ºÂìÅÂç°ÔºàÊéíÈô§Â∑≤ÈÄâÊã©ÁöÑÔºâ
                    return this.availableGiftCards.filter(card => 
                        !this.taskForm.selectedGiftCards.includes(card.id)
                    )
                },

                hasIphonePendingTasks() {
                    return this.getTasksByProduct('iphone').some(task => task.status === 'pending')
                }
            },

            beforeUnmount() {
                console.log('üîÑ VueÁªÑ‰ª∂Âç≥Â∞ÜÂç∏ËΩΩÔºåÊ∏ÖÁêÜËµÑÊ∫ê...')
                this.stopPolling()

                // Ê∏ÖÁêÜWebSocketËøûÊé•
                if (this.socket) {
                    this.socket.disconnect()
                    this.socket = null
                }

                // Ê∏ÖÁêÜÂÆöÊó∂Âô®
                if (this.pollingInterval) {
                    clearInterval(this.pollingInterval)
                    this.pollingInterval = null
                }
            },
            methods: {
                // ÂÆâÂÖ®Êõ¥Êñ∞‰ªªÂä°ÁöÑÊñπÊ≥ï
                safeUpdateTask(taskId, updates) {
                    try {
                        const taskIndex = this.tasks.findIndex(t => t.id === taskId)
                        if (taskIndex >= 0) {
                            // ‰ΩøÁî®VueÁöÑÂìçÂ∫îÂºèÊõ¥Êñ∞
                            this.tasks[taskIndex] = { ...this.tasks[taskIndex], ...updates }
                            return true
                        }
                        return false
                    } catch (error) {
                        console.error('‚ùå Êõ¥Êñ∞‰ªªÂä°Â§±Ë¥•:', error)
                        return false
                    }
                },

                initWebSocket() {
                    console.log('üîå ÂàùÂßãÂåñWebSocketËøûÊé• - RedisÂêåÊ≠•Êû∂ÊûÑv2.0')
                    this.connectionStatus = 'connecting'

                    this.socket = io('http://localhost:5001')

                    // ==================== Âü∫Á°ÄËøûÊé•‰∫ã‰ª∂ ====================
                    this.socket.on('connect', () => {
                        this.isConnected = true
                        this.connectionStatus = 'connected'
                        this.reconnectAttempts = 0
                        console.log('‚úÖ WebSocketÂ∑≤ËøûÊé• - RedisÂêåÊ≠•Â∑≤ÂêØÁî®')
                        this.addSystemLog('WebSocketËøûÊé•ÊàêÂäü - RedisÂêåÊ≠•Â∑≤ÂêØÁî®', 'success')
                        ElMessage.success('WebSocketËøûÊé•ÊàêÂäü')

                        // Ëé∑ÂèñÂàùÂßãÊï∞ÊçÆ
                        this.socket.emit('get_tasks')
                        this.socket.emit('get_system_status')
                        
                        // üöÄ SOTAÈ´òÈ¢ëÂêåÊ≠•ÔºöÊØè500ms‰∏ªÂä®ËØ∑Ê±Ç‰∏ÄÊ¨°‰ªªÂä°Áä∂ÊÄÅ
                        setInterval(() => {
                            if (this.isConnected) {
                                this.socket.emit('get_tasks')
                            }
                        }, 500)
                    })

                    this.socket.on('disconnect', (reason) => {
                        this.isConnected = false
                        this.connectionStatus = 'disconnected'
                        console.log('‚ùå WebSocketËøûÊé•Êñ≠ÂºÄ:', reason)
                        this.addSystemLog(`WebSocketËøûÊé•Êñ≠ÂºÄ: ${reason}`, 'warning')

                        // Â¶ÇÊûú‰∏çÊòØ‰∏ªÂä®Êñ≠ÂºÄÔºåÂ∞ùËØïÈáçËøû
                        if (reason !== 'io client disconnect') {
                            this.reconnectWebSocket()
                        }
                    })

                    this.socket.on('connect_error', (error) => {
                        this.handleWebSocketError(error)
                    })

                    this.socket.on('error', (error) => {
                        this.handleWebSocketError(error)
                    })

                    // ==================== Âü∫Á°ÄÊï∞ÊçÆ‰∫ã‰ª∂ÔºàÂêëÂêéÂÖºÂÆπÔºâ====================
                    this.socket.on('initial_tasks', (data) => {
                        try {
                            console.log('üìã Êî∂Âà∞ÂàùÂßã‰ªªÂä°ÂàóË°®:', data)
                            if (data && Array.isArray(data.tasks)) {
                                this.tasks = data.tasks
                            } else {
                                this.tasks = []
                            }
                        } catch (error) {
                            console.error('Â§ÑÁêÜinitial_tasks‰∫ã‰ª∂ÈîôËØØ:', error)
                            this.tasks = []
                        }
                    })

                    this.socket.on('tasks_list', (data) => {
                        try {
                            console.log('üìã Êî∂Âà∞‰ªªÂä°ÂàóË°®Êõ¥Êñ∞:', data)
                            if (data && Array.isArray(data.tasks)) {
                                console.log(`‚úÖ Êõ¥Êñ∞‰ªªÂä°ÂàóË°®: ${data.tasks.length} ‰∏™‰ªªÂä°`)
                                this.tasks = data.tasks

                                // üöÄ Á°Æ‰øùÊØè‰∏™‰ªªÂä°ÈÉΩÊúâÁ§ºÂìÅÂç°ËæìÂÖ•ÂàùÂßãÂåñ
                                data.tasks.forEach(task => {
                                    if (task.status === 'waiting_gift_card_input' && !this.taskGiftCardInputs[task.id]) {
                                        this.taskGiftCardInputs[task.id] = [{ number: '' }]
                                        console.log(`üéÅ ‰∏∫‰ªªÂä° ${task.id} ÂàùÂßãÂåñÁ§ºÂìÅÂç°ËæìÂÖ•`)
                                    }
                                })

                                // Âº∫Âà∂VueÈáçÊñ∞Ê∏≤Êüì
                                this.$forceUpdate()
                            } else {
                                console.warn('‚ö†Ô∏è Êî∂Âà∞ÁöÑ‰ªªÂä°Êï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ:', data)
                                this.tasks = []
                            }
                        } catch (error) {
                            console.error('‚ùå Â§ÑÁêÜtasks_list‰∫ã‰ª∂ÈîôËØØ:', error)
                            this.tasks = []
                        }
                    })

                    this.socket.on('system_status', (data) => {
                        try {
                            console.log('üìä Êî∂Âà∞Á≥ªÁªüÁä∂ÊÄÅ:', data)
                            if (data) {
                                this.systemStatus = data
                            }
                        } catch (error) {
                            console.error('Â§ÑÁêÜsystem_status‰∫ã‰ª∂ÈîôËØØ:', error)
                        }
                    })

                    // ==================== ‰ªªÂä°Êìç‰Ωú‰∫ã‰ª∂ ====================
                    this.socket.on('task_created', (task) => {
                        console.log('‚úÖ ‰ªªÂä°ÂàõÂª∫ÊàêÂäü:', task)
                        this.addSystemLog(`‰ªªÂä°ÂàõÂª∫ÊàêÂäü: ${task.config.name}`, 'success')

                        // Ê£ÄÊü•‰ªªÂä°ÊòØÂê¶Â∑≤Â≠òÂú®ÔºåÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†
                        const existingIndex = this.tasks.findIndex(t => t.id === task.id)
                        if (existingIndex === -1) {
                            this.tasks.push(task)
                            ElMessage.success('‰ªªÂä°ÂàõÂª∫ÊàêÂäü')
                        }

                        // ÂÖ≥Èó≠ÂàõÂª∫ÂØπËØùÊ°Ü
                        if (this.creating) {
                            this.creating = false
                            this.closeCreateDialog()
                        }
                    })

                    this.socket.on('task_create_error', (data) => {
                        console.log('‚ùå ‰ªªÂä°ÂàõÂª∫Â§±Ë¥•:', data)
                        ElMessage.error(data.error || '‰ªªÂä°ÂàõÂª∫Â§±Ë¥•')
                        this.creating = false
                    })

                    // ==================== RedisÂêåÊ≠•‰∫ã‰ª∂Ôºà‰∏ªË¶ÅÈÄªËæëÔºâ====================

                    // ‰ªªÂä°Áä∂ÊÄÅÂêåÊ≠•‰∫ã‰ª∂
                    this.socket.on('task_status_update', (data) => {
                        console.log('üìä [RedisÂêåÊ≠•] ‰ªªÂä°Áä∂ÊÄÅÊõ¥Êñ∞:', data)
                        this.handleRedisTaskStatusUpdate(data)
                    })

                    // Ê≠•È™§Êõ¥Êñ∞ÂêåÊ≠•‰∫ã‰ª∂
                    this.socket.on('step_update', (data) => {
                        console.log('üîÑ [RedisÂêåÊ≠•] Ê≠•È™§Êõ¥Êñ∞:', data)
                        this.handleRedisStepUpdate(data)
                    })

                    // ‰ªªÂä°Êó•ÂøóÂêåÊ≠•‰∫ã‰ª∂
                    this.socket.on('task_log', (data) => {
                        console.log('üìù [RedisÂêåÊ≠•] ‰ªªÂä°Êó•Âøó:', data)
                        this.handleRedisTaskLog(data)
                    })

                    // üöÄ Á§ºÂìÅÂç°ËæìÂÖ•ËØ∑Ê±Ç‰∫ã‰ª∂ - ÁÆÄÂåñÁâà
                    this.socket.on('gift_card_input_required', (data) => {
                        console.log('üéÅ Á§ºÂìÅÂç°ËæìÂÖ•ËØ∑Ê±Ç:', data)
                        // ‰ªªÂä°Áä∂ÊÄÅ‰ºöËá™Âä®Êõ¥Êñ∞‰∏∫waiting_gift_card_inputÔºåÂâçÁ´Ø‰ºöÊòæÁ§∫ËæìÂÖ•ÁïåÈù¢
                        ElMessage.info('üí≥ ‰ªªÂä°Â∑≤Âà∞ËææÁ§ºÂìÅÂç°ËæìÂÖ•Èò∂ÊÆµÔºåËØ∑Âú®‰ªªÂä°ÂàóË°®‰∏≠ËæìÂÖ•Á§ºÂìÅÂç°')
                    })

                    this.socket.on('gift_card_submit_success', (data) => {
                        console.log('‚úÖ Á§ºÂìÅÂç°Êèê‰∫§ÊàêÂäü:', data)
                        ElMessage.success('üéâ Á§ºÂìÅÂç°Êèê‰∫§ÊàêÂäüÔºå‰ªªÂä°ÁªßÁª≠ÊâßË°å')
                    })

                    this.socket.on('gift_card_submit_error', (data) => {
                        console.log('‚ùå Á§ºÂìÅÂç°Êèê‰∫§Â§±Ë¥•:', data)
                        ElMessage.error(`‚ùå Á§ºÂìÅÂç°Êèê‰∫§Â§±Ë¥•: ${data.message}`)
                    })

                    // ==================== ‰º†Áªü‰∫ã‰ª∂ÔºàÂêëÂêéÂÖºÂÆπÔºå‰ºòÂÖàÁ∫ß‰ΩéÔºâ====================
                    this.socket.on('task_update', (task) => {
                        console.log('üìã [‰º†Áªü] ‰ªªÂä°Êõ¥Êñ∞:', task)
                        // Âè™Âú®Redis‰∫ã‰ª∂Êú™Â§ÑÁêÜÊó∂Êâç‰ΩøÁî®‰º†ÁªüÊõ¥Êñ∞
                        this.handleLegacyTaskUpdate(task)
                    })

                    this.socket.on('task_start_success', (data) => {
                        console.log('üöÄ ‰ªªÂä°ÂêØÂä®ÊàêÂäü:', data)
                        ElMessage.success(`‰ªªÂä° ${data.task_id} ÂêØÂä®ÊàêÂäü`)
                        
                        // Á´ãÂç≥Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ‰∏∫ËøêË°å‰∏≠
                        const taskIndex = this.tasks.findIndex(t => t.id === data.task_id)
                        if (taskIndex >= 0) {
                            this.tasks[taskIndex].status = 'running'
                            this.tasks[taskIndex].progress = 0
                            this.tasks[taskIndex].started_at = new Date().toISOString()
                            console.log('üîÑ ‰ªªÂä°Áä∂ÊÄÅÂ∑≤Á´ãÂç≥Êõ¥Êñ∞‰∏∫ËøêË°å‰∏≠')
                        }
                    })

                    this.socket.on('task_start_error', (data) => {
                        ElMessage.error(`‰ªªÂä°ÂêØÂä®Â§±Ë¥•: ${data.message}`)
                    })

                    this.socket.on('task_cancel_success', (data) => {
                        ElMessage.warning(`‰ªªÂä° ${data.task_id} Â∑≤ÂèñÊ∂à`)
                    })

                    this.socket.on('task_cancel_error', (data) => {
                        ElMessage.error(`‰ªªÂä°ÂèñÊ∂àÂ§±Ë¥•: ${data.message}`)
                    })

                    this.socket.on('task_delete_success', (data) => {
                        console.log('Êî∂Âà∞ task_delete_success ‰∫ã‰ª∂:', data)
                        // ‰ªéÊú¨Âú∞‰ªªÂä°ÂàóË°®‰∏≠ÁßªÈô§
                        const index = this.tasks.findIndex(t => t.id === data.task_id)
                        if (index >= 0) {
                            this.tasks.splice(index, 1)
                        }
                        ElMessage.success('‰ªªÂä°Âà†Èô§ÊàêÂäü')
                    })

                    this.socket.on('task_deleted', (data) => {
                        console.log('Êî∂Âà∞ task_deleted ‰∫ã‰ª∂:', data)
                        // ‰ªéÊú¨Âú∞‰ªªÂä°ÂàóË°®‰∏≠ÁßªÈô§
                        const index = this.tasks.findIndex(t => t.id === data.task_id)
                        if (index >= 0) {
                            this.tasks.splice(index, 1)
                            console.log('‰ªªÂä°Â∑≤‰ªéÂàóË°®‰∏≠ÁßªÈô§:', data.task_id)
                        }
                    })

                    this.socket.on('error', (data) => {
                        console.error('WebSocketÈîôËØØ:', data)
                        ElMessage.error(data.message || 'ÂèëÁîüÊú™Áü•ÈîôËØØ')
                    })

                    // ==================== ÂÖ∂‰ªñ‰∫ã‰ª∂ ====================
                    this.socket.on('debug_message', (data) => {
                        console.log('üî• Êî∂Âà∞ÂêéÁ´ØË∞ÉËØïÊ∂àÊÅØ:', data)
                    })

                    // ÁõëÂê¨‰ªªÂä°ÊâßË°åÈîôËØØ
                    this.socket.on('task_error', (data) => {
                        console.error('‰ªªÂä°ÊâßË°åÈîôËØØ:', data)
                        ElMessage.error(`‰ªªÂä° ${data.task_id} ÊâßË°åÈîôËØØ: ${data.message}`)
                    })

                    // ÁõëÂê¨Ëá™Âä®ÂåñÊ≠•È™§ÈîôËØØ
                    this.socket.on('automation_error', (data) => {
                        console.error('Ëá™Âä®ÂåñÈîôËØØ:', data)
                        ElMessage.error(`Ëá™Âä®ÂåñÈîôËØØ: ${data.message}`)
                    })

                    // Êñ∞Â¢ûÔºöÁõëÂê¨Á§ºÂìÅÂç°ÈîôËØØ‰∫ã‰ª∂
                    this.socket.on('gift_card_error', (data) => {
                        console.log('üö® Êî∂Âà∞Á§ºÂìÅÂç°ÈîôËØØ‰∫ã‰ª∂:', data)
                        const { task_id, gift_card_number, error_status, error_message } = data
                        
                        // Êü•ÊâæÂØπÂ∫îÁöÑ‰ªªÂä°Âπ∂Êõ¥Êñ∞ÈîôËØØ‰ø°ÊÅØ
                        const taskIndex = this.tasks.findIndex(t => t.id === task_id)
                        if (taskIndex >= 0) {
                            const task = this.tasks[taskIndex]
                            
                            // Ê∑ªÂä†Á§ºÂìÅÂç°ÈîôËØØ‰ø°ÊÅØÂà∞‰ªªÂä°
                            if (!task.gift_card_errors) {
                                task.gift_card_errors = []
                            }
                            
                            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ËØ•Âç°ÁöÑÈîôËØØ
                            const existingErrorIndex = task.gift_card_errors.findIndex(err => err.card_number === gift_card_number)
                            
                            const errorInfo = {
                                card_number: gift_card_number,
                                status: error_status,
                                message: error_message,
                                timestamp: new Date().toISOString()
                            }
                            
                            if (existingErrorIndex >= 0) {
                                // Êõ¥Êñ∞Áé∞ÊúâÈîôËØØ
                                task.gift_card_errors[existingErrorIndex] = errorInfo
                            } else {
                                // Ê∑ªÂä†Êñ∞ÈîôËØØ
                                task.gift_card_errors.push(errorInfo)
                            }
                            
                            // Êõ¥Êñ∞‰ªªÂä°
                            this.tasks[taskIndex] = { ...task }
                            
                            // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                            ElMessage.error(`Á§ºÂìÅÂç°ÈîôËØØ: ${gift_card_number} - ${error_message}`)
                            
                            // Á≥ªÁªüÊó•Âøó
                            this.addSystemLog(`üéÅ‚ùå Á§ºÂìÅÂç°ÈîôËØØ: ${gift_card_number} -> ${error_status}`, 'error')
                        }
                    })

                    // Êñ∞Â¢ûÔºöÁõëÂê¨‰ΩôÈ¢ù‰∏çË∂≥ÈîôËØØ‰∫ã‰ª∂
                    this.socket.on('payment_balance_error', (data) => {
                        console.log('üí≥ Êî∂Âà∞‰ΩôÈ¢ù‰∏çË∂≥ÈîôËØØ‰∫ã‰ª∂:', data)
                        const { task_id, error_message, remaining_amount, full_error } = data
                        
                        // ÂÆâÂÖ®Êõ¥Êñ∞‰ªªÂä°ÁöÑ‰ΩôÈ¢ùÈîôËØØ‰ø°ÊÅØ
                        const updated = this.safeUpdateTask(task_id, {
                            balance_error: {
                                message: error_message,
                                remaining_amount: remaining_amount,
                                full_error: full_error,
                                timestamp: new Date().toISOString()
                            }
                        })

                        if (updated) {
                            // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                            ElMessage.error(`‰ΩôÈ¢ù‰∏çË∂≥: ${remaining_amount}`)

                            // Á≥ªÁªüÊó•Âøó
                            this.addSystemLog(`üí≥‚ùå ‰ΩôÈ¢ù‰∏çË∂≥: ${remaining_amount}`, 'error')
                        }
                    })

                    // Êñ∞Â¢ûÔºöÁõëÂê¨ÈáçÊñ∞ËøêË°å‰ªªÂä°ÊàêÂäü‰∫ã‰ª∂
                    this.socket.on('rerun_task_success', (data) => {
                        console.log('üîÑ Êî∂Âà∞ÈáçÊñ∞ËøêË°å‰ªªÂä°ÊàêÂäü‰∫ã‰ª∂:', data)
                        const { task_id } = data
                        
                        // Êü•ÊâæÂØπÂ∫îÁöÑ‰ªªÂä°Âπ∂Êõ¥Êñ∞Áä∂ÊÄÅ
                        const taskIndex = this.tasks.findIndex(t => t.id === task_id)
                        if (taskIndex >= 0) {
                            const task = this.tasks[taskIndex]
                            task.rerunning = false
                            this.tasks[taskIndex] = { ...task }
                        }
                        
                        ElMessage.success('‰ªªÂä°ÈáçÊñ∞ËøêË°åÊàêÂäü')
                        this.addSystemLog(`üîÑ‚úÖ ‰ªªÂä°ÈáçÊñ∞ËøêË°åÊàêÂäü: ${task_id}`, 'success')
                    })

                    // Êñ∞Â¢ûÔºöÁõëÂê¨ÈáçÊñ∞ËøêË°å‰ªªÂä°Â§±Ë¥•‰∫ã‰ª∂
                    this.socket.on('rerun_task_error', (data) => {
                        console.log('üîÑ‚ùå Êî∂Âà∞ÈáçÊñ∞ËøêË°å‰ªªÂä°Â§±Ë¥•‰∫ã‰ª∂:', data)
                        const { task_id, message } = data
                        
                        // Êü•ÊâæÂØπÂ∫îÁöÑ‰ªªÂä°Âπ∂Êõ¥Êñ∞Áä∂ÊÄÅ
                        const taskIndex = this.tasks.findIndex(t => t.id === task_id)
                        if (taskIndex >= 0) {
                            const task = this.tasks[taskIndex]
                            task.rerunning = false
                            this.tasks[taskIndex] = { ...task }
                        }
                        
                        ElMessage.error(`ÈáçÊñ∞ËøêË°å‰ªªÂä°Â§±Ë¥•: ${message}`)
                        this.addSystemLog(`üîÑ‚ùå ‰ªªÂä°ÈáçÊñ∞ËøêË°åÂ§±Ë¥•: ${task_id} - ${message}`, 'error')
                    })

                    // ËØ∑Ê±ÇÂàùÂßãÊï∞ÊçÆ - Â¢ûÂº∫Áâà
                    setTimeout(() => {
                        console.log('üîÑ ËØ∑Ê±ÇÂàùÂßãÊï∞ÊçÆ...')
                        this.socket.emit('get_tasks')
                        this.socket.emit('get_system_status')

                        // üöÄ ÊåÅÁª≠ËØ∑Ê±Ç‰ªªÂä°Áä∂ÊÄÅÔºåÁ°Æ‰øùÂâçÁ´ØÈáçÂêØÂêéËÉΩÊÅ¢Â§ç‰ªªÂä°ËøΩË∏™
                        const requestTasksInterval = setInterval(() => {
                            if (this.isConnected) {
                                this.socket.emit('get_tasks')
                            }
                        }, 2000) // ÊØè2ÁßíËØ∑Ê±Ç‰∏ÄÊ¨°

                        // 10ÁßíÂêéÂÅúÊ≠¢È¢ëÁπÅËØ∑Ê±ÇÔºåÊîπ‰∏∫Ê≠£Â∏∏Èó¥Èöî
                        setTimeout(() => {
                            clearInterval(requestTasksInterval)
                            console.log('‚úÖ ÂàùÂßãÊï∞ÊçÆÂêåÊ≠•ÂÆåÊàêÔºåÂàáÊç¢Âà∞Ê≠£Â∏∏Êõ¥Êñ∞Èó¥Èöî')
                        }, 10000)
                    }, 500)
                },

                switchProduct(productKey) {
                    console.log('üîÑ ÂàáÊç¢‰∫ßÂìÅÈ°µÈù¢:', productKey)
                    console.log('üîÑ ÂΩìÂâç‰∫ßÂìÅ (ÂàáÊç¢Ââç):', this.currentProduct)

                    this.currentProduct = productKey
                    const productMap = {
                        'iphone': 'iPhone',
                        'mac': 'Mac',
                        'ipad': 'iPad',
                        'watch': 'Apple Watch',
                        'accounts': 'Ë¥¶Âè∑ÁÆ°ÁêÜ',
                        'gift-cards': 'Á§ºÂìÅÂç°ÁÆ°ÁêÜ',
                        'ip-pool': 'IPÊ±†ÁÆ°ÁêÜ'
                    }
                    this.currentProductType = productMap[productKey] || 'Unknown'

                    console.log('‚úÖ ‰∫ßÂìÅÈ°µÈù¢ÂàáÊç¢ÂÆåÊàê:', this.currentProduct, '->', this.currentProductType)

                    // Âä†ËΩΩÂØπÂ∫îÈ°µÈù¢ÁöÑÊï∞ÊçÆ
                    if (productKey === 'accounts') {
                        this.loadAccounts()
                    } else if (productKey === 'gift-cards') {
                        this.loadGiftCards()
                        this.loadGiftCardStatuses()
                    } else if (productKey === 'ip-pool') {
                        this.refreshIpStatus()
                    }
                },

                openCreateDialog(productType) {
                    this.currentProductType = productType === 'iphone' ? 'iPhone' :
                                           productType === 'mac' ? 'Mac' :
                                           productType === 'ipad' ? 'iPad' : 'Apple Watch'
                    this.showCreateDialog = true
                    this.resetTaskForm()
                },

                closeCreateDialog() {
                    this.showCreateDialog = false
                    this.resetTaskForm()
                },
                
                // Á§ºÂìÅÂç°Â§öÈÄâÁõ∏ÂÖ≥ÊñπÊ≥ï
                addGiftCard() {
                    if (this.tempGiftCardSelection && !this.taskForm.selectedGiftCards.includes(this.tempGiftCardSelection)) {
                        this.taskForm.selectedGiftCards.push(this.tempGiftCardSelection)
                        this.tempGiftCardSelection = null
                        // Ëß¶ÂèëË°®ÂçïÈ™åËØÅ
                        this.$nextTick(() => {
                            this.$refs.taskFormRef?.validateField('selectedGiftCards')
                        })
                    }
                },
                
                removeSelectedGiftCard(index) {
                    this.taskForm.selectedGiftCards.splice(index, 1)
                    // Ëß¶ÂèëË°®ÂçïÈ™åËØÅ
                    this.$nextTick(() => {
                        this.$refs.taskFormRef?.validateField('selectedGiftCards')
                    })
                },
                
                getGiftCardDisplayName(cardId) {
                    const card = this.giftCards.find(c => c.id === cardId)
                    return card ? `${card.gift_card_number} (${card.status})` : cardId
                },

                resetTaskForm() {
                    this.taskForm = {
                        name: '',
                        url: '',
                        selectedAccount: null,
                        selectedModel: '',
                        selectedSize: '',
                        selectedStorage: '',
                        selectedColor: '',
                        priority: 2
                    }
                    this.generatedUrl = ''
                    this.isValidUrl = true
                },

                // ÁßªÈô§È¢ÑËÆæË¥¶Âè∑ÈÄâÊã©ÊñπÊ≥ï - Â∑≤Â∫üÂºÉ
                // onAccountSelect ÊñπÊ≥ïÂ∑≤Âà†Èô§

                async loadIphoneConfigs() {
                    try {
                        console.log('üîÑ ÂºÄÂßãÂä†ËΩΩiPhoneÈÖçÁΩÆ...')
                        const response = await axios.get('http://localhost:5001/api/config/iphone-configs')
                        console.log('‚úÖ iPhoneÈÖçÁΩÆÂä†ËΩΩÊàêÂäü:', response.data)
                        console.log('üìä Ê®°ÂûãÊï∞Èáè:', Object.keys(response.data.models || {}).length)
                        this.iphoneConfigs = response.data
                        console.log('üì± VueÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞:', this.iphoneConfigs)
                    } catch (error) {
                        console.error('‚ùå Âä†ËΩΩiPhoneÈÖçÁΩÆÂ§±Ë¥•:', error)
                        console.error('ÈîôËØØËØ¶ÊÉÖ:', error.response?.data || error.message)
                        ElMessage.error('Âä†ËΩΩiPhoneÈÖçÁΩÆÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                onModelChange() {
                    // ÈáçÁΩÆÂêéÁª≠ÈÄâÊã©
                    this.taskForm.selectedSize = ''
                    this.taskForm.selectedStorage = ''
                    this.taskForm.selectedColor = ''
                    this.generatedUrl = ''
                },

                onSizeChange() {
                    // ÈáçÁΩÆÂêéÁª≠ÈÄâÊã©
                    this.taskForm.selectedStorage = ''
                    this.taskForm.selectedColor = ''
                    this.generatedUrl = ''
                },

                onStorageChange() {
                    // ÈáçÁΩÆÈ¢úËâ≤ÈÄâÊã©
                    this.taskForm.selectedColor = ''
                    this.generatedUrl = ''
                },

                async onColorChange() {
                    if (this.taskForm.selectedModel && this.taskForm.selectedSize &&
                        this.taskForm.selectedStorage && this.taskForm.selectedColor) {
                        await this.generateUrl()
                    }
                },

                async generateUrl() {
                    try {
                        const response = await axios.post('http://localhost:5001/api/config/generate-url', {
                            model: this.taskForm.selectedModel,
                            size: this.taskForm.selectedSize,
                            storage: this.taskForm.selectedStorage,
                            color: this.taskForm.selectedColor
                        })

                        if (response.data.success) {
                            this.generatedUrl = response.data.url
                            this.taskForm.url = response.data.url
                            this.isValidUrl = true
                        }
                    } catch (error) {
                        console.error('Failed to generate URL:', error)
                        ElMessage.error('ÁîüÊàêURLÂ§±Ë¥•')
                    }
                },

                async parseUrl() {
                    if (!this.taskForm.url) {
                        ElMessage.warning('ËØ∑ÂÖàËæìÂÖ•URL')
                        return
                    }

                    this.parsingUrl = true
                    try {
                        const response = await axios.post('http://localhost:5001/api/config/parse-url', {
                            url: this.taskForm.url
                        })

                        if (response.data.success) {
                            const config = response.data.config
                            this.taskForm.selectedModel = config.model
                            this.taskForm.selectedSize = config.size
                            this.taskForm.selectedStorage = config.storage
                            this.taskForm.selectedColor = config.color
                            this.generatedUrl = this.taskForm.url
                            this.isValidUrl = true
                            ElMessage.success('URLËß£ÊûêÊàêÂäü')
                        } else {
                            this.isValidUrl = false
                            ElMessage.error(response.data.error || 'URLËß£ÊûêÂ§±Ë¥•')
                        }
                    } catch (error) {
                        console.error('Failed to parse URL:', error)
                        this.isValidUrl = false
                        ElMessage.error('URLËß£ÊûêÂ§±Ë¥•')
                    } finally {
                        this.parsingUrl = false
                    }
                },

                parseUrlIfNeeded() {
                    if (this.taskForm.url && this.taskForm.url.includes('apple.com/uk/shop/buy-iphone/')) {
                        this.parseUrl()
                    }
                },

                copyUrl() {
                    if (this.generatedUrl) {
                        navigator.clipboard.writeText(this.generatedUrl).then(() => {
                            ElMessage.success('URLÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')
                        }).catch(() => {
                            ElMessage.error('Â§çÂà∂Â§±Ë¥•')
                        })
                    }
                },

                createTask() {
                    this.$refs.taskFormRef.validate((valid) => {
                        if (valid) {
                            this.creating = true

                            // Ëé∑ÂèñÊòæÁ§∫ÂêçÁß∞
                            const modelDisplayName = this.iphoneConfigs.models[this.taskForm.selectedModel]?.name || this.taskForm.selectedModel
                            const sizeDisplayName = this.iphoneConfigs.models[this.taskForm.selectedModel]?.sizes[this.taskForm.selectedSize]?.name || this.taskForm.selectedSize
                            const storageDisplayName = this.iphoneConfigs.storage_display_names[this.taskForm.selectedStorage] || this.taskForm.selectedStorage
                            const colorDisplayName = this.iphoneConfigs.color_display_names[this.taskForm.selectedColor] || this.taskForm.selectedColor

                            // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑË¥¶Âè∑‰ø°ÊÅØÂíåÁ§ºÂìÅÂç°‰ø°ÊÅØ
                            const selectedAccount = this.accounts.find(acc => acc.id === this.taskForm.selectedAccount)
                            
                            // ÂøÖÈ°ªÈÄâÊã©Ë¥¶Âè∑
                            if (!selectedAccount) {
                                ElMessage.error('ËØ∑ÈÄâÊã©Apple IDË¥¶Âè∑')
                                this.creating = false
                                return
                            }
                            
                            // üöÄ Á§ºÂìÅÂç°Â∞ÜÂú®ËøêË°åÊó∂Âä®ÊÄÅËæìÂÖ•ÔºåËøôÈáå‰∏çÈúÄË¶ÅÈ¢ÑËÆæ

                            const taskData = {
                                name: this.taskForm.name,
                                url: this.taskForm.url || this.generatedUrl,
                                account_config: {
                                    email: selectedAccount.email,
                                    password: selectedAccount.password,
                                    phone_number: selectedAccount.phone_number || '07700900000'
                                },
                                // üöÄ Á§ºÂìÅÂç°Êï∞ÁªÑ‰∏∫Á©∫ - Á≥ªÁªüÂ∞ÜÂú®ËøêË°åÊó∂ÂºπÂá∫ËæìÂÖ•ÁïåÈù¢
                                gift_cards: [],
                                product_config: {
                                    model: sizeDisplayName, // ‰ΩøÁî®ÂÆåÊï¥ÁöÑÂ∞∫ÂØ∏ÂêçÁß∞
                                    storage: storageDisplayName,
                                    finish: colorDisplayName,
                                    trade_in: 'No trade-in',
                                    payment: 'Buy',
                                    apple_care: 'No AppleCare+ Coverage'
                                },
                                enabled: true,
                                priority: this.taskForm.priority,
                                use_proxy: false
                            }

                            // Ë∞ÉËØïÔºöÊâìÂç∞ÂèëÈÄÅÁöÑÊï∞ÊçÆ
                            console.log('üîç ÂâçÁ´ØÂèëÈÄÅ‰ªªÂä°Êï∞ÊçÆ:', taskData);
                            console.log('üöÄ Á§ºÂìÅÂç°Â∞ÜÂú®ËøêË°åÊó∂Âä®ÊÄÅËæìÂÖ•');

                            // ÂèëÈÄÅÂàõÂª∫‰ªªÂä°ËØ∑Ê±Ç
                            console.log('üöÄ ÂèëÈÄÅÂàõÂª∫‰ªªÂä°ËØ∑Ê±ÇÂà∞ÂêéÁ´Ø...')
                            this.socket.emit('create_task', taskData)

                            // ËÆæÁΩÆË∂ÖÊó∂Â§ÑÁêÜ
                            setTimeout(() => {
                                if (this.creating) {
                                    console.log('‚è∞ ÂàõÂª∫‰ªªÂä°Ë∂ÖÊó∂ÔºåÂèØËÉΩÂêéÁ´ØÊ≤°ÊúâÂìçÂ∫î')
                                    ElMessage.error('ÂàõÂª∫‰ªªÂä°Ë∂ÖÊó∂ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°ÊòØÂê¶Ê≠£Â∏∏ËøêË°å')
                                    this.creating = false
                                }
                            }, 10000) // 10ÁßíË∂ÖÊó∂

                            // ‰∏çË¶ÅÁ´ãÂç≥ÂÖ≥Èó≠ÂØπËØùÊ°ÜÔºåÁ≠âÂæÖÊúçÂä°Âô®ÂìçÂ∫î
                        }
                    })
                },

                startTask(taskId) {
                    this.socket.emit('start_task', { task_id: taskId })
                    ElMessage.success('‰ªªÂä°ÂêØÂä®ËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ')
                },

                async startAllTasks() {
                    const pendingTasks = this.pendingTasks

                    if (pendingTasks.length === 0) {
                        ElMessage.warning('Ê≤°ÊúâÂæÖÊâßË°åÁöÑ‰ªªÂä°')
                        return
                    }

                    ElMessageBox.confirm(
                        `Á°ÆÂÆöË¶ÅÂêØÂä® ${pendingTasks.length} ‰∏™ÂæÖÊâßË°å‰ªªÂä°ÂêóÔºü`,
                        'ÊâπÈáèÂêØÂä®‰ªªÂä°',
                        {
                            confirmButtonText: 'ÂêØÂä®',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning'
                        }
                    ).then(() => {
                        this.startingAllTasks = true

                        // ÈÄê‰∏™ÂêØÂä®‰ªªÂä°ÔºåÈó¥Èöî500msÈÅøÂÖçÊúçÂä°Âô®ÂéãÂäõ
                        let index = 0
                        const startNext = () => {
                            if (index < pendingTasks.length) {
                                const task = pendingTasks[index]
                                this.socket.emit('start_task', { task_id: task.id })
                                index++
                                setTimeout(startNext, 500)
                            } else {
                                this.startingAllTasks = false
                                ElMessage.success(`Â∑≤ÂêØÂä® ${pendingTasks.length} ‰∏™‰ªªÂä°`)
                            }
                        }

                        startNext()
                    }).catch(() => {
                        // Áî®Êà∑ÂèñÊ∂à
                    })
                },

                startIphoneTasks() {
                    const iphoneTasks = this.getTasksByProduct('iphone').filter(task => task.status === 'pending')

                    if (iphoneTasks.length === 0) {
                        ElMessage.warning('Ê≤°ÊúâÂæÖÊâßË°åÁöÑiPhone‰ªªÂä°')
                        return
                    }

                    ElMessageBox.confirm(
                        `Á°ÆÂÆöË¶ÅÂêØÂä® ${iphoneTasks.length} ‰∏™iPhone‰ªªÂä°ÂêóÔºü`,
                        'ÊâπÈáèÂêØÂä®iPhone‰ªªÂä°',
                        {
                            confirmButtonText: 'ÂêØÂä®',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning'
                        }
                    ).then(() => {
                        iphoneTasks.forEach((task, index) => {
                            setTimeout(() => {
                                this.socket.emit('start_task', { task_id: task.id })
                            }, index * 500) // Èó¥Èöî500msÂêØÂä®
                        })
                        ElMessage.success(`Â∑≤ÂêØÂä® ${iphoneTasks.length} ‰∏™iPhone‰ªªÂä°`)
                    }).catch(() => {
                        // Áî®Êà∑ÂèñÊ∂à
                    })
                },

                cancelTask(taskId) {
                    ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂèñÊ∂àËøô‰∏™‰ªªÂä°ÂêóÔºü', 'Á°ÆËÆ§ÂèñÊ∂à', {
                        confirmButtonText: 'Á°ÆÂÆö',
                        cancelButtonText: 'ÂèñÊ∂à',
                        type: 'warning'
                    }).then(() => {
                        this.socket.emit('cancel_task', { task_id: taskId })
                        ElMessage.warning('‰ªªÂä°ÂèñÊ∂àËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ')
                    })
                },

                deleteTask(taskId) {
                    ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰ªªÂä°ÂêóÔºüÂà†Èô§ÂêéÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ', 'Á°ÆËÆ§Âà†Èô§', {
                        confirmButtonText: 'Âà†Èô§',
                        cancelButtonText: 'ÂèñÊ∂à',
                        type: 'error'
                    }).then(() => {
                        this.socket.emit('delete_task', { task_id: taskId })
                        ElMessage.error('‰ªªÂä°Âà†Èô§ËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ')
                    })
                },

                viewTaskDetail(task) {
                    this.selectedTask = task
                    this.showDetailDialog = true
                },

                handleCommand(command) {
                    switch(command) {
                        case 'status':
                            this.showSystemStatus()
                            break
                        case 'logs':
                            this.showSystemLogs()
                            break
                        case 'settings':
                            ElMessage.info('Á≥ªÁªüËÆæÁΩÆÂäüËÉΩÂºÄÂèë‰∏≠...')
                            break
                        case 'stop-all':
                            this.stopAllTasks()
                            break
                    }
                },

                showSystemStatus() {
                    const statusInfo = `
                        üìä Á≥ªÁªüÁä∂ÊÄÅ‰ø°ÊÅØ

                        ÊÄª‰ªªÂä°Êï∞: ${this.tasks.length}
                        Á≠âÂæÖ‰∏≠: ${this.pendingTasks.length}
                        ËøêË°å‰∏≠: ${this.runningTasks.length}
                        Â∑≤ÂÆåÊàê: ${this.getTasksByStatus('completed').length}
                        Â§±Ë¥•: ${this.getTasksByStatus('failed').length}
                        Â∑≤ÂèñÊ∂à: ${this.getTasksByStatus('cancelled').length}

                        ËøûÊé•Áä∂ÊÄÅ: ${this.isConnected ? '‚úÖ Â∑≤ËøûÊé•' : '‚ùå Êú™ËøûÊé•'}
                        ÊúÄÂ§ßÂπ∂Âèë: ${this.systemStatus.max_concurrent}
                    `

                    ElMessageBox.alert(statusInfo, 'Á≥ªÁªüÁä∂ÊÄÅ', {
                        confirmButtonText: 'Á°ÆÂÆö',
                        type: 'info'
                    })
                },

                stopAllTasks() {
                    const runningTasks = this.runningTasks

                    if (runningTasks.length === 0) {
                        ElMessage.warning('Ê≤°ÊúâÊ≠£Âú®ËøêË°åÁöÑ‰ªªÂä°')
                        return
                    }

                    ElMessageBox.confirm(
                        `Á°ÆÂÆöË¶ÅÂÅúÊ≠¢ ${runningTasks.length} ‰∏™Ê≠£Âú®ËøêË°åÁöÑ‰ªªÂä°ÂêóÔºü`,
                        'ÊâπÈáèÂÅúÊ≠¢‰ªªÂä°',
                        {
                            confirmButtonText: 'ÂÅúÊ≠¢',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning'
                        }
                    ).then(() => {
                        runningTasks.forEach(task => {
                            this.socket.emit('cancel_task', { task_id: task.id })
                        })
                        ElMessage.success(`Â∑≤ÂèëÈÄÅÂÅúÊ≠¢ËØ∑Ê±ÇÁªô ${runningTasks.length} ‰∏™‰ªªÂä°`)
                    }).catch(() => {
                        // Áî®Êà∑ÂèñÊ∂à
                    })
                },

                getTasksByProduct(productType) {
                    return this.tasks.filter(task => {
                        const url = task.config.url || ''
                        switch(productType) {
                            case 'iphone':
                                return url.includes('iphone')
                            case 'mac':
                                return url.includes('mac')
                            case 'ipad':
                                return url.includes('ipad')
                            case 'watch':
                                return url.includes('watch')
                            default:
                                return false
                        }
                    })
                },

                getTasksByStatus(status) {
                    return this.tasks.filter(task => task.status === status)
                },

                getProductType(task) {
                    const url = task.config.url || ''
                    if (url.includes('iphone')) return 'iPhone'
                    if (url.includes('mac')) return 'Mac'
                    if (url.includes('ipad')) return 'iPad'
                    if (url.includes('watch')) return 'Apple Watch'
                    return 'Êú™Áü•'
                },

                getStatusType(status) {
                    const statusMap = {
                        'pending': '',
                        'running': 'warning',
                        'completed': 'success',
                        'failed': 'danger',
                        'cancelled': 'info',
                        'waiting_gift_card_input': 'primary'
                    }
                    return statusMap[status] || ''
                },

                getStatusText(status) {
                    const statusMap = {
                        'pending': 'Á≠âÂæÖ‰∏≠',
                        'running': 'ËøêË°å‰∏≠',
                        'completed': 'Â∑≤ÂÆåÊàê',
                        'failed': 'Â§±Ë¥•',
                        'cancelled': 'Â∑≤ÂèñÊ∂à',
                        'waiting_gift_card_input': 'Á≠âÂæÖÁ§ºÂìÅÂç°'
                    }
                    return statusMap[status] || status
                },

                formatTime(timestamp) {
                    if (!timestamp) return 'N/A'
                    // Ê£ÄÊü•dayjsÊòØÂê¶ÂèØÁî®
                    if (typeof dayjs === 'undefined') {
                        console.warn('dayjsÊú™ÂÆö‰πâÔºå‰ΩøÁî®ÂéüÁîüDateÊ†ºÂºèÂåñ')
                        return new Date(timestamp).toLocaleString('zh-CN')
                    }
                    return dayjs(timestamp).format('YYYY-MM-DD HH:mm:ss')
                },

                refreshTasks() {
                    console.log('ÊâãÂä®Âà∑Êñ∞‰ªªÂä°ÂàóË°®...')
                    this.socket.emit('get_tasks')
                    this.socket.emit('get_system_status')
                    ElMessage.info('Ê≠£Âú®Âà∑Êñ∞‰ªªÂä°ÂàóË°®...')
                },

                showSystemLogs() {
                    this.showSystemLogsDialog = true
                },

                addSystemLog(message, level = 'info') {
                    const log = {
                        timestamp: new Date(),
                        message: message,
                        level: level
                    }
                    this.systemLogs.unshift(log)

                    // Âè™‰øùÁïôÊúÄËøë100Êù°Êó•Âøó
                    if (this.systemLogs.length > 100) {
                        this.systemLogs = this.systemLogs.slice(0, 100)
                    }
                },

                // ==================== Ë¥¶Âè∑ÁÆ°ÁêÜÊñπÊ≥ï ====================

                async loadAccounts() {
                    try {
                        console.log('üîÑ ÂºÄÂßãÂä†ËΩΩË¥¶Êà∑Êï∞ÊçÆ...')
                        const response = await axios.get('http://localhost:5001/api/accounts')
                        console.log('‚úÖ Ë¥¶Êà∑Êï∞ÊçÆÂä†ËΩΩÊàêÂäü:', response.data)
                        this.accounts = response.data.map(account => ({
                            ...account,
                            phone_number: account.phone_number || '07700900000'
                        }))
                        console.log('üìä Â§ÑÁêÜÂêéÁöÑË¥¶Êà∑Êï∞Èáè:', this.accounts.length)
                    } catch (error) {
                        console.error('‚ùå Âä†ËΩΩË¥¶Âè∑Â§±Ë¥•:', error)
                        ElMessage.error('Âä†ËΩΩË¥¶Âè∑Â§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                editAccount(account) {
                    this.editingAccount = account
                    this.accountForm = {
                        email: account.email,
                        password: '', // ‰∏çÊòæÁ§∫ÂéüÂØÜÁ†Å
                        phone_number: account.phone_number || '07700900000'
                    }
                    this.showCreateAccountDialog = true
                },

                async saveAccount() {
                    this.$refs.accountFormRef.validate(async (valid) => {
                        if (valid) {
                            this.savingAccount = true
                            try {
                                if (this.editingAccount) {
                                    // Êõ¥Êñ∞Ë¥¶Âè∑
                                    await axios.put(`http://localhost:5001/api/accounts/${this.editingAccount.id}`, this.accountForm)
                                    ElMessage.success('Ë¥¶Âè∑Êõ¥Êñ∞ÊàêÂäü')
                                } else {
                                    // ÂàõÂª∫Ë¥¶Âè∑
                                    await axios.post('http://localhost:5001/api/accounts', this.accountForm)
                                    ElMessage.success('Ë¥¶Âè∑ÂàõÂª∫ÊàêÂäü')
                                }

                                this.closeAccountDialog()
                                this.loadAccounts()

                            } catch (error) {
                                console.error('‰øùÂ≠òË¥¶Âè∑Â§±Ë¥•:', error)
                                ElMessage.error(error.response?.data?.error || '‰øùÂ≠òË¥¶Âè∑Â§±Ë¥•')
                            } finally {
                                this.savingAccount = false
                            }
                        }
                    })
                },

                closeAccountDialog() {
                    this.showCreateAccountDialog = false
                    this.editingAccount = null
                    this.accountForm = {
                        email: '',
                        password: '',
                        phone_number: '07700900000'
                    }
                    if (this.$refs.accountFormRef) {
                        this.$refs.accountFormRef.resetFields()
                    }
                },

                async deleteAccount(accountId) {
                    ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ë¥¶Âè∑ÂêóÔºü', 'Á°ÆËÆ§Âà†Èô§', {
                        confirmButtonText: 'Âà†Èô§',
                        cancelButtonText: 'ÂèñÊ∂à',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`http://localhost:5001/api/accounts/${accountId}`)
                            ElMessage.success('Ë¥¶Âè∑Âà†Èô§ÊàêÂäü')
                            this.loadAccounts()
                        } catch (error) {
                            console.error('Âà†Èô§Ë¥¶Âè∑Â§±Ë¥•:', error)
                            ElMessage.error('Âà†Èô§Ë¥¶Âè∑Â§±Ë¥•')
                        }
                    }).catch(() => {
                        // Áî®Êà∑ÂèñÊ∂à
                    })
                },

                // ==================== Á§ºÂìÅÂç°ÁÆ°ÁêÜÊñπÊ≥ï ====================

                async loadGiftCards() {
                    try {
                        console.log('üîÑ ÂºÄÂßãÂä†ËΩΩÁ§ºÂìÅÂç°Êï∞ÊçÆ...')
                        const params = this.giftCardStatusFilter ? { status: this.giftCardStatusFilter } : {}
                        const response = await axios.get('http://localhost:5001/api/gift-cards', { params })
                        console.log('‚úÖ Á§ºÂìÅÂç°Êï∞ÊçÆÂä†ËΩΩÊàêÂäü:', response.data)
                        this.giftCards = response.data
                        console.log('üìä Á§ºÂìÅÂç°Êï∞Èáè:', this.giftCards.length)
                    } catch (error) {
                        console.error('‚ùå Âä†ËΩΩÁ§ºÂìÅÂç°Â§±Ë¥•:', error)
                        ElMessage.error('Âä†ËΩΩÁ§ºÂìÅÂç°Â§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                async loadGiftCardStatuses() {
                    try {
                        console.log('üîÑ ÂºÄÂßãÂä†ËΩΩÁ§ºÂìÅÂç°Áä∂ÊÄÅ...')
                        const response = await axios.get('http://localhost:5001/api/gift-card-statuses')
                        console.log('‚úÖ Á§ºÂìÅÂç°Áä∂ÊÄÅÂä†ËΩΩÊàêÂäü:', response.data)
                        this.giftCardStatuses = response.data
                        if (!this.giftCardForm.status && this.giftCardStatuses.length > 0) {
                            this.giftCardForm.status = this.giftCardStatuses[0]
                        }
                        console.log('üìä Á§ºÂìÅÂç°Áä∂ÊÄÅÊï∞Èáè:', this.giftCardStatuses.length)
                    } catch (error) {
                        console.error('‚ùå Âä†ËΩΩÁ§ºÂìÅÂç°Áä∂ÊÄÅÂ§±Ë¥•:', error)
                        ElMessage.error('Âä†ËΩΩÁ§ºÂìÅÂç°Áä∂ÊÄÅÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                editGiftCard(giftCard) {
                    this.editingGiftCard = giftCard
                    this.giftCardForm = {
                        gift_card_number: giftCard.gift_card_number,
                        status: giftCard.status,
                        notes: giftCard.notes
                    }
                    this.showCreateGiftCardDialog = true
                },

                async saveGiftCard() {
                    this.$refs.giftCardFormRef.validate(async (valid) => {
                        if (valid) {
                            this.savingGiftCard = true
                            try {
                                if (this.editingGiftCard) {
                                    // Êõ¥Êñ∞Á§ºÂìÅÂç°
                                    await axios.put(`http://localhost:5001/api/gift-cards/${this.editingGiftCard.id}`, this.giftCardForm)
                                    ElMessage.success('Á§ºÂìÅÂç°Êõ¥Êñ∞ÊàêÂäü')
                                } else {
                                    // ÂàõÂª∫Á§ºÂìÅÂç°
                                    await axios.post('http://localhost:5001/api/gift-cards', this.giftCardForm)
                                    ElMessage.success('Á§ºÂìÅÂç°ÂàõÂª∫ÊàêÂäü')
                                }

                                this.closeGiftCardDialog()
                                this.loadGiftCards()

                            } catch (error) {
                                console.error('‰øùÂ≠òÁ§ºÂìÅÂç°Â§±Ë¥•:', error)
                                ElMessage.error(error.response?.data?.error || '‰øùÂ≠òÁ§ºÂìÅÂç°Â§±Ë¥•')
                            } finally {
                                this.savingGiftCard = false
                            }
                        }
                    })
                },

                closeGiftCardDialog() {
                    this.showCreateGiftCardDialog = false
                    this.editingGiftCard = null
                    this.giftCardForm = { gift_card_number: '', status: '', notes: '' }
                    if (this.$refs.giftCardFormRef) {
                        this.$refs.giftCardFormRef.resetFields()
                    }
                },

                async deleteGiftCard(cardId) {
                    ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Á§ºÂìÅÂç°ÂêóÔºü', 'Á°ÆËÆ§Âà†Èô§', {
                        confirmButtonText: 'Âà†Èô§',
                        cancelButtonText: 'ÂèñÊ∂à',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`http://localhost:5001/api/gift-cards/${cardId}`)
                            ElMessage.success('Á§ºÂìÅÂç°Âà†Èô§ÊàêÂäü')
                            this.loadGiftCards()
                        } catch (error) {
                            console.error('Âà†Èô§Á§ºÂìÅÂç°Â§±Ë¥•:', error)
                            ElMessage.error('Âà†Èô§Á§ºÂìÅÂç°Â§±Ë¥•')
                        }
                    }).catch(() => {
                        // Áî®Êà∑ÂèñÊ∂à
                    })
                },



                getGiftCardStatusType(status) {
                    const statusMap = {
                        'ÊúâÈ¢ùÂ∫¶': 'success',
                        '0‰ΩôÈ¢ù': 'warning',
                        'ÈùûÊú¨ÂõΩÂç°': 'danger',
                        'Ë¢´ÂÖÖÂÄº': 'info'
                    }
                    return statusMap[status] || ''
                },

                // ==================== IPÊ±†ÁÆ°ÁêÜÊñπÊ≥ï ====================

                async refreshIpStatus() {
                    this.loadingIpStatus = true
                    try {
                        const response = await axios.get('/api/ip/status')
                        this.ipStatus = response.data
                        
                        // Êõ¥Êñ∞ËÆæÁΩÆ
                        const settingsResponse = await axios.get('/api/ip/settings')
                        this.ipSettings = settingsResponse.data
                        
                        // Êõ¥Êñ∞‰ª£ÁêÜÂàóË°®ÔºàÊ®°ÊãüÔºåÂÆûÈôÖÈúÄË¶ÅÂêéÁ´ØÊèê‰æõÂàóË°®Êé•Âè£Ôºâ
                        this.updateProxyList()
                        
                        ElMessage.success('IPÁä∂ÊÄÅÂ∑≤Âà∑Êñ∞')
                    } catch (error) {
                        ElMessage.error('Âà∑Êñ∞IPÁä∂ÊÄÅÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    } finally {
                        this.loadingIpStatus = false
                    }
                },

                async rotateIpManually() {
                    this.rotatingIp = true
                    try {
                        const response = await axios.post('/api/system/rotate-ip')
                        ElMessage.success('IPËΩÆÊç¢ÊàêÂäü: ' + response.data.message)
                        await this.refreshIpStatus()
                    } catch (error) {
                        ElMessage.error('IPËΩÆÊç¢Â§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    } finally {
                        this.rotatingIp = false
                    }
                },

                async updateIpSettings() {
                    try {
                        await axios.put('/api/ip/settings', this.ipSettings)
                        ElMessage.success('IPËÆæÁΩÆÂ∑≤Êõ¥Êñ∞')
                    } catch (error) {
                        ElMessage.error('Êõ¥Êñ∞IPËÆæÁΩÆÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                async addProxy() {
                    if (!await this.$refs.proxyFormRef.validate()) return
                    
                    this.addingProxy = true
                    try {
                        // ËøôÈáåÂ∫îËØ•Ë∞ÉÁî®Ê∑ªÂä†‰ª£ÁêÜÁöÑAPI
                        const proxyData = {
                            ...this.proxyForm,
                            status: 'active',
                            success_rate: 0,
                            response_time: 0
                        }
                        
                        // Ê®°ÊãüAPIË∞ÉÁî®
                        await new Promise(resolve => setTimeout(resolve, 1000))
                        
                        this.proxyList.push(proxyData)
                        this.showAddProxyDialog = false
                        this.resetProxyForm()
                        ElMessage.success('‰ª£ÁêÜÊ∑ªÂä†ÊàêÂäü')
                    } catch (error) {
                        ElMessage.error('Ê∑ªÂä†‰ª£ÁêÜÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    } finally {
                        this.addingProxy = false
                    }
                },

                resetProxyForm() {
                    this.proxyForm = {
                        host: '',
                        port: null,
                        protocol: 'http',
                        country: '',
                        username: '',
                        password: ''
                    }
                    this.$refs.proxyFormRef?.resetFields()
                },

                async testProxy(proxy) {
                    this.testingProxy = proxy.host
                    try {
                        // Ê®°Êãü‰ª£ÁêÜÊµãËØï
                        await new Promise(resolve => setTimeout(resolve, 2000))
                        
                        proxy.status = 'active'
                        proxy.response_time = Math.random() * 2
                        proxy.success_count = (proxy.success_count || 0) + 1
                        
                        ElMessage.success(`‰ª£ÁêÜ ${proxy.host}:${proxy.port} ÊµãËØïÈÄöËøá`)
                    } catch (error) {
                        proxy.status = 'failed'
                        proxy.failure_count = (proxy.failure_count || 0) + 1
                        ElMessage.error(`‰ª£ÁêÜ ${proxy.host}:${proxy.port} ÊµãËØïÂ§±Ë¥•`)
                    } finally {
                        this.testingProxy = null
                    }
                },

                async blockProxy(proxy) {
                    try {
                        await axios.post('/api/ip/block', {
                            ip_address: `${proxy.host}:${proxy.port}`,
                            reason: 'Manual block'
                        })
                        
                        proxy.status = 'blocked'
                        ElMessage.success(`‰ª£ÁêÜ ${proxy.host}:${proxy.port} Â∑≤Â∞ÅÁ¶Å`)
                    } catch (error) {
                        ElMessage.error('Â∞ÅÁ¶Å‰ª£ÁêÜÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                async unblockProxy(proxy) {
                    try {
                        // ËøôÈáåÂ∫îËØ•Ë∞ÉÁî®Ëß£Â∞ÅAPI
                        proxy.status = 'active'
                        ElMessage.success(`‰ª£ÁêÜ ${proxy.host}:${proxy.port} Â∑≤Ëß£Â∞Å`)
                    } catch (error) {
                        ElMessage.error('Ëß£Â∞Å‰ª£ÁêÜÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    }
                },

                async removeProxy(proxy) {
                    try {
                        await ElMessageBox.confirm(
                            `Á°ÆÂÆöË¶ÅÂà†Èô§‰ª£ÁêÜ ${proxy.host}:${proxy.port} ÂêóÔºü`,
                            'Á°ÆËÆ§Âà†Èô§',
                            { type: 'warning' }
                        )
                        
                        const index = this.proxyList.findIndex(p => p.host === proxy.host && p.port === proxy.port)
                        if (index > -1) {
                            this.proxyList.splice(index, 1)
                            ElMessage.success('‰ª£ÁêÜÂ∑≤Âà†Èô§')
                        }
                    } catch (error) {
                        // Áî®Êà∑ÂèñÊ∂àÂà†Èô§
                    }
                },

                getProxyStatusType(status) {
                    const statusMap = {
                        'active': 'success',
                        'failed': 'danger',
                        'blocked': 'warning',
                        'testing': 'info',
                        'cooldown': 'info'
                    }
                    return statusMap[status] || ''
                },

                getSuccessRateColor(rate) {
                    if (rate >= 0.8) return '#67C23A'
                    if (rate >= 0.6) return '#E6A23C'
                    return '#F56C6C'
                },

                // ‰ª£ÁêÜAPIÈÖçÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï
                onApiTypeChange() {
                    // Ê†πÊçÆAPIÁ±ªÂûãÈ¢ÑÂ°´ÂÖÖ‰∏Ä‰∫õÈªòËÆ§ÂÄº
                    const presets = {
                        'proxymesh': {
                            apiUrl: 'https://proxymesh.com/api/proxies',
                            headers: '{"User-Agent": "ProxyMesh Client"}'
                        },
                        'brightdata': {
                            apiUrl: 'https://brightdata.com/api/zone/proxies',
                            headers: '{"Authorization": "Bearer YOUR_TOKEN"}'
                        }
                    }
                    
                    const preset = presets[this.apiForm.apiType]
                    if (preset) {
                        this.apiForm.apiUrl = preset.apiUrl
                        this.apiForm.headers = preset.headers
                    }
                },

                async testProxyApi() {
                    if (!await this.$refs.apiFormRef.validate()) return
                    
                    this.testingApi = true
                    try {
                        // Ê®°ÊãüAPIÊµãËØï
                        await new Promise(resolve => setTimeout(resolve, 2000))
                        ElMessage.success('APIËøûÊé•ÊµãËØïÊàêÂäü')
                    } catch (error) {
                        ElMessage.error('APIËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    } finally {
                        this.testingApi = false
                    }
                },

                async syncProxiesFromApi() {
                    this.syncingProxies = true
                    try {
                        // Ê®°Êãü‰ªéAPIÂêåÊ≠•‰ª£ÁêÜ
                        await new Promise(resolve => setTimeout(resolve, 3000))
                        
                        // Ê∑ªÂä†‰∏Ä‰∫õÊ®°Êãü‰ª£ÁêÜÂà∞ÂàóË°®
                        const mockProxies = [
                            { host: '45.76.96.205', port: 8080, country: 'US', protocol: 'http', status: 'active', success_rate: 0.85, response_time: 1.2 },
                            { host: '104.238.174.211', port: 3128, country: 'UK', protocol: 'http', status: 'active', success_rate: 0.92, response_time: 0.8 },
                            { host: '149.28.105.139', port: 8080, country: 'CA', protocol: 'http', status: 'active', success_rate: 0.76, response_time: 1.5 }
                        ]
                        
                        this.proxyList = [...this.proxyList, ...mockProxies]
                        ElMessage.success(`ÊàêÂäüÂêåÊ≠• ${mockProxies.length} ‰∏™‰ª£ÁêÜ`)
                    } catch (error) {
                        ElMessage.error('ÂêåÊ≠•‰ª£ÁêÜÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    } finally {
                        this.syncingProxies = false
                    }
                },

                async saveProxyApiConfig() {
                    if (!await this.$refs.apiFormRef.validate()) return
                    
                    this.savingApiConfig = true
                    try {
                        // ËøôÈáåÂ∫îËØ•‰øùÂ≠òAPIÈÖçÁΩÆÂà∞ÂêéÁ´Ø
                        await new Promise(resolve => setTimeout(resolve, 1000))
                        
                        this.showProxyApiDialog = false
                        ElMessage.success('APIÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü')
                    } catch (error) {
                        ElMessage.error('‰øùÂ≠òAPIÈÖçÁΩÆÂ§±Ë¥•: ' + (error.response?.data?.error || error.message))
                    } finally {
                        this.savingApiConfig = false
                    }
                },

                updateProxyList() {
                    // Ê®°Êãü‰ª£ÁêÜÂàóË°®Êõ¥Êñ∞
                    if (this.proxyList.length === 0) {
                        this.proxyList = [
                            { host: '127.0.0.1', port: 8080, country: 'US', protocol: 'http', status: 'active', success_rate: 0.9, response_time: 0.5, last_used: new Date().toISOString() },
                            { host: '127.0.0.1', port: 8081, country: 'UK', protocol: 'http', status: 'active', success_rate: 0.85, response_time: 0.7, last_used: null },
                            { host: '127.0.0.1', port: 8082, country: 'CA', protocol: 'http', status: 'blocked', success_rate: 0.2, response_time: 2.1, last_used: new Date(Date.now() - 3600000).toISOString() }
                        ]
                    }
                },

                onAccountChange() {
                    // Ë¥¶Âè∑ÈÄâÊã©ÂèòÂåñÊó∂ÁöÑÂ§ÑÁêÜ
                    console.log('ÈÄâÊã©ÁöÑË¥¶Âè∑ID:', this.taskForm.selectedAccount)
                },

                // ==================== ËΩÆËØ¢ÊñπÊ≥ï ====================

                startPolling() {
                    if (this.pollingEnabled && !this.pollingInterval) {
                        console.log('üîÑ ÂêØÂä®Áä∂ÊÄÅËΩÆËØ¢ÔºåÈ¢ëÁéá:', this.pollingFrequency + 'ms')
                        this.pollingInterval = setInterval(() => {
                            this.pollTaskStatus()
                        }, this.pollingFrequency)
                    }
                },

                stopPolling() {
                    if (this.pollingInterval) {
                        console.log('‚èπÔ∏è ÂÅúÊ≠¢Áä∂ÊÄÅËΩÆËØ¢')
                        clearInterval(this.pollingInterval)
                        this.pollingInterval = null
                    }
                },

                async pollTaskStatus() {
                    try {
                        // Âè™ÊúâÂú®ÊúâÊ¥ªË∑É‰ªªÂä°Êó∂ÊâçËΩÆËØ¢
                        const activeTasks = this.tasks.filter(task =>
                            task.status === 'running' || task.status === 'pending'
                        )

                        if (activeTasks.length === 0) {
                            return
                        }

                        // ÈÄöËøáWebSocketËØ∑Ê±ÇÊúÄÊñ∞‰ªªÂä°Áä∂ÊÄÅ
                        if (this.socket && this.isConnected) {
                            this.socket.emit('get_tasks')
                        }

                    } catch (error) {
                        console.error('ËΩÆËØ¢‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•:', error)
                    }
                },

                formatStepName(step) {
                    const stepMap = {
                        'initializing': 'üöÄ ÂàùÂßãÂåñÊµèËßàÂô®',
                        'navigating': 'üß≠ ÂØºËà™Âà∞È°µÈù¢', 
                        'configuring_product': '‚öôÔ∏è ÈÖçÁΩÆ‰∫ßÂìÅ',
                        'adding_to_bag': 'üõçÔ∏è Ê∑ªÂä†Âà∞Ë¥≠Áâ©Ë¢ã',
                        'checkout': 'üí≥ ËøõÂÖ•ÁªìË¥¶',
                        'applying_gift_card': 'üéÅ Â∫îÁî®Á§ºÂìÅÂç°',
                        'finalizing': '‚úÖ ÂÆåÊàêË¥≠‰π∞',
                        // Êñ∞Â¢ûÊõ¥Â§öÁªÜÁ≤íÂ∫¶Ê≠•È™§
                        'started': '‚ñ∂Ô∏è ÂºÄÂßã',
                        'progress': '‚è≥ ËøõË°å‰∏≠', 
                        'completed': '‚úÖ ÂÆåÊàê',
                        'failed': '‚ùå Â§±Ë¥•',
                        'gift_card_link_click': 'üîó ÁÇπÂáªÁ§ºÂìÅÂç°ÈìæÊé•',
                        'gift_card_input': 'üìù Â°´ÂÜôÁ§ºÂìÅÂç°Âè∑Á†Å',
                        'gift_card_apply': '‚ú® Â∫îÁî®Á§ºÂìÅÂç°',
                        'multiple_gift_cards': 'üéÅ Â§öÂº†Á§ºÂìÅÂç°Â§ÑÁêÜ'
                    }
                    return stepMap[step] || step
                },

                getLatestLog(task) {
                    if (!task.logs || task.logs.length === 0) {
                        return 'ÊöÇÊó†Êó•Âøó'
                    }
                    const latestLog = task.logs[task.logs.length - 1]
                    return latestLog.message || 'ÊöÇÊó†Ê∂àÊÅØ'
                },

                // ==================== Á§ºÂìÅÂç°ÈîôËØØÂ§ÑÁêÜÊñπÊ≥ï ====================
                
                getGiftCardErrorType(status) {
                    const statusMap = {
                        'ÈùûÊú¨ÂõΩÂç°': 'danger',
                        '0‰ΩôÈ¢ù': 'warning',
                        'ÊúâÈ¢ùÂ∫¶': 'success'
                    }
                    return statusMap[status] || 'info'
                },

                // ==================== ‰ªªÂä°ÈáçÊñ∞ËøêË°åÊñπÊ≥ï ====================
                
                async rerunTask(task) {
                    try {
                        // Á°ÆËÆ§ÈáçÊñ∞ËøêË°å
                        await ElMessageBox.confirm(
                            `Á°ÆÂÆöË¶ÅÈáçÊñ∞ËøêË°å‰ªªÂä° "${task.config.name}" ÂêóÔºüËøôÂ∞ÜÈáçÁΩÆ‰ªªÂä°Áä∂ÊÄÅÂπ∂‰ΩøÁî®Áõ∏ÂêåÁöÑÈÖçÁΩÆÈáçÊñ∞ÊâßË°å„ÄÇ`,
                            'ÈáçÊñ∞ËøêË°å‰ªªÂä°',
                            {
                                confirmButtonText: 'ÈáçÊñ∞ËøêË°å',
                                cancelButtonText: 'ÂèñÊ∂à',
                                type: 'warning'
                            }
                        )

                        // ËÆæÁΩÆÈáçÊñ∞ËøêË°åÂä†ËΩΩÁä∂ÊÄÅ
                        task.rerunning = true

                        // ÈáçÁΩÆ‰ªªÂä°Áä∂ÊÄÅÂíåÈîôËØØ‰ø°ÊÅØ
                        const resetData = {
                            task_id: task.id,
                            action: 'reset_and_restart'
                        }

                        // ÂèëÈÄÅÈáçÊñ∞ËøêË°åËØ∑Ê±Ç
                        this.socket.emit('rerun_task', resetData)

                        ElMessage.success('‰ªªÂä°Â∑≤ÈáçÁΩÆÔºåÊ≠£Âú®ÈáçÊñ∞ÂêØÂä®...')

                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('ÈáçÊñ∞ËøêË°å‰ªªÂä°Â§±Ë¥•:', error)
                            ElMessage.error('ÈáçÊñ∞ËøêË°å‰ªªÂä°Â§±Ë¥•')
                        }
                    } finally {
                        task.rerunning = false
                    }
                },

                // ==================== Êñ∞Â¢ûÔºöÊ≠•È™§ÁÆ°ÁêÜÊñπÊ≥ï ====================
                
                getTaskSteps() {
                    return [
                        { step: 'initializing', icon: 'üöÄ', label: 'ÂàùÂßãÂåñ' },
                        { step: 'navigating', icon: 'üß≠', label: 'ÂØºËà™' },
                        { step: 'configuring_product', icon: '‚öôÔ∏è', label: 'ÈÖçÁΩÆ' },
                        { step: 'adding_to_bag', icon: 'üõçÔ∏è', label: 'Ê∑ªÂä†' },
                        { step: 'checkout', icon: 'üí≥', label: 'ÁªìË¥¶' },
                        { step: 'applying_gift_card', icon: 'üéÅ', label: 'Á§ºÂìÅÂç°' },
                        { step: 'finalizing', icon: '‚úÖ', label: 'ÂÆåÊàê' }
                    ]
                },

                isStepCompleted(task, step) {
                    const steps = ['initializing', 'navigating', 'configuring_product', 'adding_to_bag', 'checkout', 'applying_gift_card', 'finalizing']
                    const currentStepIndex = steps.indexOf(task.current_step)
                    const checkStepIndex = steps.indexOf(step)
                    return checkStepIndex < currentStepIndex
                },

                // ==================== Â¢ûÂº∫ÁöÑWebSocketËøûÊé•ÁÆ°ÁêÜ ====================
                
                reconnectWebSocket() {
                    if (this.reconnectAttempts >= this.maxReconnectAttempts) {
                        console.error('WebSocketÈáçËøûÊ¨°Êï∞Â∑≤Ëææ‰∏äÈôê')
                        ElMessage.error('WebSocketËøûÊé•Â§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï')
                        return
                    }

                    this.reconnectAttempts++
                    console.log(`WebSocketÈáçËøûÂ∞ùËØï ${this.reconnectAttempts}/${this.maxReconnectAttempts}`)
                    
                    setTimeout(() => {
                        this.initWebSocket()
                    }, 2000 * this.reconnectAttempts) // ÈÄíÂ¢ûÂª∂Ëøü
                },

                handleWebSocketError(error) {
                    console.error('WebSocketÈîôËØØ:', error)
                    this.isConnected = false
                    this.connectionStatus = 'disconnected'
                    
                    // Ëá™Âä®ÈáçËøû
                    if (this.reconnectAttempts < this.maxReconnectAttempts) {
                        this.reconnectWebSocket()
                    }
                }
            },

            async mounted() {
                console.log('üöÄ VueÁªÑ‰ª∂ÂºÄÂßãÊåÇËΩΩ...')

                try {
                    // ÂàùÂßãÂåñÊï∞ÊçÆÔºà‰ªªÂä°Êï∞ÊçÆÈÄöËøáWebSocketËé∑ÂèñÔºå‰∏çÈúÄË¶ÅÂçïÁã¨Âä†ËΩΩÔºâ
                    console.log('üë§ Âä†ËΩΩË¥¶Êà∑Êï∞ÊçÆ...')
                    await this.loadAccounts()

                    console.log('üéÅ Âä†ËΩΩÁ§ºÂìÅÂç°Êï∞ÊçÆ...')
                    await this.loadGiftCards()

                    console.log('üì± Âä†ËΩΩiPhoneÈÖçÁΩÆ...')
                    await this.loadIphoneConfigs()

                    console.log('üè∑Ô∏è Âä†ËΩΩÁ§ºÂìÅÂç°Áä∂ÊÄÅ...')
                    await this.loadGiftCardStatuses()

                    // ÂàùÂßãÂåñIPÁÆ°ÁêÜÊï∞ÊçÆ
                    if (this.currentProduct === 'ip-pool') {
                        console.log('üåê ÂàùÂßãÂåñIPÁÆ°ÁêÜÊï∞ÊçÆ...')
                        await this.refreshIpStatus()
                    }

                    // ÂàùÂßãÂåñWebSocketÔºà‰ªªÂä°Êï∞ÊçÆ‰ºöÈÄöËøáWebSocketÁöÑinitial_tasks‰∫ã‰ª∂Ëé∑ÂèñÔºâ
                    console.log('üîå ÂàùÂßãÂåñWebSocket...')
                    this.initWebSocket()

                    // ÂêØÂä®ËΩÆËØ¢
                    console.log('‚è∞ ÂêØÂä®ËΩÆËØ¢...')
                    this.startPolling()

                    console.log('‚úÖ VueÁªÑ‰ª∂ÊåÇËΩΩÂÆåÊàê')
                } catch (error) {
                    console.error('‚ùå VueÁªÑ‰ª∂ÊåÇËΩΩËøáÁ®ã‰∏≠Âá∫Èîô:', error)
                }
            },
















            // ==================== RedisÂêåÊ≠•‰∫ã‰ª∂Â§ÑÁêÜÊñπÊ≥ï ====================

            handleRedisTaskStatusUpdate(data) {
                /**
                 * Â§ÑÁêÜRedis‰ªªÂä°Áä∂ÊÄÅÊõ¥Êñ∞‰∫ã‰ª∂
                 */
                try {
                    console.log('üîÑ Â§ÑÁêÜRedis‰ªªÂä°Áä∂ÊÄÅÊõ¥Êñ∞:', data)
                    if (!data || !data.task_id) {
                        console.warn('‚ö†Ô∏è Êó†ÊïàÁöÑ‰ªªÂä°Áä∂ÊÄÅÊõ¥Êñ∞Êï∞ÊçÆ')
                        return
                    }

                    const task = this.tasks.find(t => t && t.id === data.task_id)
                    if (task) {
                        // ÂÆâÂÖ®Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ
                        if (data.status) task.status = data.status
                        if (data.progress !== undefined) task.progress = data.progress
                        if (data.message) task.current_step = data.message

                        // Êõ¥Êñ∞Êó∂Èó¥Êà≥
                        task.last_updated = new Date().toISOString()

                        // Á≥ªÁªüÊó•Âøó - ÂÆâÂÖ®ËÆøÈóÆconfig
                        const taskName = task.config && task.config.name ? task.config.name : task.id
                        this.addSystemLog(`üìä [Redis] ‰ªªÂä°Áä∂ÊÄÅÊõ¥Êñ∞: ${taskName} -> ${data.status}`, 'info')

                        console.log(`‚úÖ Redis‰ªªÂä°Áä∂ÊÄÅÂ∑≤ÂêåÊ≠•: ${data.task_id} -> ${data.status}`)
                    } else {
                        console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${data.task_id}`)
                    }
                } catch (error) {
                    console.error('Â§ÑÁêÜRedis‰ªªÂä°Áä∂ÊÄÅÊõ¥Êñ∞ÈîôËØØ:', error)
                }
            },

            handleRedisStepUpdate(data) {
                /**
                 * Â§ÑÁêÜRedisÊ≠•È™§Êõ¥Êñ∞‰∫ã‰ª∂
                 */
                try {
                    console.log('üîÑ Â§ÑÁêÜRedisÊ≠•È™§Êõ¥Êñ∞:', data)
                    if (!data || !data.task_id) {
                        console.warn('‚ö†Ô∏è Êó†ÊïàÁöÑÊ≠•È™§Êõ¥Êñ∞Êï∞ÊçÆ')
                        return
                    }

                    const task = this.tasks.find(t => t && t.id === data.task_id)
                    if (task) {
                        // ÂÆâÂÖ®Êõ¥Êñ∞Ê≠•È™§‰ø°ÊÅØ
                        if (data.step) task.current_step = data.step
                        if (data.progress !== undefined) task.progress = data.progress
                        if (data.status) task.status = data.status

                        // Êõ¥Êñ∞Êó∂Èó¥Êà≥
                        task.last_updated = new Date().toISOString()

                        // Á≥ªÁªüÊó•Âøó - ÂÆâÂÖ®ËÆøÈóÆconfig
                        const taskName = task.config && task.config.name ? task.config.name : task.id
                        this.addSystemLog(`üîÑ [Redis] Ê≠•È™§Êõ¥Êñ∞: ${taskName} -> ${data.step}`, 'info')

                        console.log(`‚úÖ RedisÊ≠•È™§Â∑≤ÂêåÊ≠•: ${data.task_id} -> ${data.step}`)
                    } else {
                        console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${data.task_id}`)
                    }
                } catch (error) {
                    console.error('Â§ÑÁêÜRedisÊ≠•È™§Êõ¥Êñ∞ÈîôËØØ:', error)
                }
            },

            handleRedisTaskLog(data) {
                /**
                 * Â§ÑÁêÜRedis‰ªªÂä°Êó•Âøó‰∫ã‰ª∂
                 */
                try {
                    console.log('üîÑ Â§ÑÁêÜRedis‰ªªÂä°Êó•Âøó:', data)
                    if (!data || !data.task_id || !data.message) {
                        console.warn('‚ö†Ô∏è Êó†ÊïàÁöÑ‰ªªÂä°Êó•ÂøóÊï∞ÊçÆ')
                        return
                    }

                    const task = this.tasks.find(t => t && t.id === data.task_id)
                    if (task) {
                        // Á°Æ‰øùÊó•ÂøóÊï∞ÁªÑÂ≠òÂú®
                        if (!task.logs) {
                            task.logs = []
                        }

                        // Ê∑ªÂä†Êñ∞Êó•Âøó
                        const logEntry = {
                            level: data.level,
                            message: data.message,
                            timestamp: data.timestamp || Date.now()
                        }
                        task.logs.push(logEntry)

                        // ÈôêÂà∂Êó•ÂøóÊï∞ÈáèÔºåÈÅøÂÖçÂÜÖÂ≠òÊ∫¢Âá∫
                        if (task.logs.length > 1000) {
                            task.logs = task.logs.slice(-500)
                        }

                        // Êõ¥Êñ∞Êó∂Èó¥Êà≥
                        task.last_updated = new Date().toISOString()

                        // Â¶ÇÊûúÊòØÂΩìÂâçÊü•ÁúãÁöÑ‰ªªÂä°Ôºå‰πüÊõ¥Êñ∞ËØ¶ÊÉÖ
                        if (this.selectedTask && this.selectedTask.id === data.task_id) {
                            this.selectedTask = { ...task }
                        }

                        console.log(`‚úÖ Redis‰ªªÂä°Êó•ÂøóÂ∑≤ÂêåÊ≠•: ${data.task_id} -> [${data.level}] ${data.message}`)
                    } else {
                        console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${data.task_id}`)
                    }
                } catch (error) {
                    console.error('Â§ÑÁêÜRedis‰ªªÂä°Êó•ÂøóÈîôËØØ:', error)
                }
            },

            handleLegacyTaskUpdate(task) {
                /**
                 * Â§ÑÁêÜ‰º†Áªü‰ªªÂä°Êõ¥Êñ∞‰∫ã‰ª∂ÔºàÂêëÂêéÂÖºÂÆπÔºâ
                 */
                console.log('üìã Â§ÑÁêÜ‰º†Áªü‰ªªÂä°Êõ¥Êñ∞:', task)

                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÈÄöËøáRedisÂ§ÑÁêÜËøá
                const existingTask = this.tasks.find(t => t.id === task.id)
                if (existingTask && existingTask.last_updated) {
                    const lastUpdate = new Date(existingTask.last_updated).getTime()
                    const now = Date.now()

                    // Â¶ÇÊûúÊúÄËøë1ÁßíÂÜÖÂ∑≤ÁªèÈÄöËøáRedisÊõ¥Êñ∞ËøáÔºåË∑≥Ëøá‰º†ÁªüÊõ¥Êñ∞
                    if (now - lastUpdate < 1000) {
                        console.log('‚è≠Ô∏è Ë∑≥Ëøá‰º†ÁªüÊõ¥Êñ∞ÔºåRedisÂ∑≤Â§ÑÁêÜ')
                        return
                    }
                }

                // ÊâßË°å‰º†ÁªüÊõ¥Êñ∞ÈÄªËæë
                const index = this.tasks.findIndex(t => t.id === task.id)
                if (index >= 0) {
                    this.tasks[index] = { ...task, last_updated: new Date().toISOString() }

                    // Â¶ÇÊûúÊòØÂΩìÂâçÊü•ÁúãÁöÑ‰ªªÂä°Ôºå‰πüÊõ¥Êñ∞ËØ¶ÊÉÖ
                    if (this.selectedTask && this.selectedTask.id === task.id) {
                        this.selectedTask = { ...task }
                    }
                } else {
                    // Â¶ÇÊûú‰ªªÂä°‰∏çÂ≠òÂú®ÔºåÊ∑ªÂä†ÂÆÉ
                    this.tasks.push({ ...task, last_updated: new Date().toISOString() })
                }

                console.log(`‚úÖ ‰º†Áªü‰ªªÂä°Êõ¥Êñ∞ÂÆåÊàê: ${task.id}`)
            },

            // ==================== üöÄ Á§ºÂìÅÂç°ËæìÂÖ•ÊñπÊ≥ï ====================

            getTaskGiftCardInputs(taskId) {
                if (!this.taskGiftCardInputs[taskId]) {
                    this.taskGiftCardInputs[taskId] = [{ number: '' }]
                }
                return this.taskGiftCardInputs[taskId]
            },

            addTaskGiftCardInput(taskId) {
                const inputs = this.getTaskGiftCardInputs(taskId)
                if (inputs.length < 8) {
                    inputs.push({ number: '' })
                    ElMessage.success(`Â∑≤Ê∑ªÂä†Á¨¨${inputs.length}Âº†Á§ºÂìÅÂç°ËæìÂÖ•Ê°Ü`)
                } else {
                    ElMessage.warning('ÊúÄÂ§öÂè™ËÉΩÊ∑ªÂä†8Âº†Á§ºÂìÅÂç°')
                }
            },

            removeTaskGiftCardInput(taskId, index) {
                const inputs = this.getTaskGiftCardInputs(taskId)
                if (inputs.length > 1 && index >= 0 && index < inputs.length) {
                    inputs.splice(index, 1)
                    ElMessage.info(`Â∑≤ÁßªÈô§Á¨¨${index + 1}Âº†Á§ºÂìÅÂç°ËæìÂÖ•Ê°Ü`)
                }
            },

            hasValidTaskGiftCards(taskId) {
                const inputs = this.getTaskGiftCardInputs(taskId)
                return inputs.some(card => card.number && card.number.trim().length > 0)
            },

            getValidTaskGiftCardCount(taskId) {
                const inputs = this.getTaskGiftCardInputs(taskId)
                return inputs.filter(card => card.number && card.number.trim().length > 0).length
            },

            onGiftCardInput(taskId, index, value) {
                console.log(`üéÅ ‰ªªÂä°${taskId} Á¨¨${index+1}Âº†Á§ºÂìÅÂç°ËæìÂÖ•:`, value)
            }
        })

        // Ê≥®ÂÜåElement Plus
        app.use(ElementPlus)

        // Ê≥®ÂÜåÂõæÊ†áÁªÑ‰ª∂ - ‰ΩøÁî®Â∞èÂÜôÂêçÁß∞‰ª•ÂåπÈÖçÊ®°Êùø‰∏≠ÁöÑ‰ΩøÁî®
        app.component('WalletFilled', WalletFilled)
        app.component('walletfilled', WalletFilled)
        app.component('WarningFilled', WarningFilled)
        app.component('warningfilled', WarningFilled)
        app.component('InfoFilled', InfoFilled)
        app.component('infofilled', InfoFilled)
        app.component('Plus', Plus)
        app.component('Delete', Delete)
        app.component('Edit', Edit)
        app.component('Refresh', Refresh)
        app.component('Search', Search)
        app.component('Setting', Setting)

        // ÊåÇËΩΩÂ∫îÁî® - Ê∑ªÂä†ÈîôËØØÂ§ÑÁêÜ
        try {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊúâVueÂ∫îÁî®ÊåÇËΩΩ
            const appElement = document.getElementById('app')
            if (appElement && appElement.__vue_app__) {
                console.log('‚ö†Ô∏è Ê£ÄÊµãÂà∞Â∑≤Â≠òÂú®ÁöÑVueÂ∫îÁî®ÔºåÂÖàÂç∏ËΩΩ...')
                appElement.__vue_app__.unmount()
            }

            console.log('üéØ ÊåÇËΩΩVueÂ∫îÁî®...')
            app.mount('#app')
            console.log('‚úÖ VueÂ∫îÁî®ÊåÇËΩΩÊàêÂäü')
        } catch (error) {
            console.error('‚ùå VueÂ∫îÁî®ÊåÇËΩΩÂ§±Ë¥•:', error)
            // Â¶ÇÊûúÊåÇËΩΩÂ§±Ë¥•ÔºåÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
            document.getElementById('app').innerHTML = `
                <div style="padding: 50px; text-align: center; color: #f56c6c;">
                    <h2>Â∫îÁî®Âä†ËΩΩÂ§±Ë¥•</h2>
                    <p>ÈîôËØØ‰ø°ÊÅØ: ${error.message}</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; background: #409eff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        ÈáçÊñ∞Âä†ËΩΩ
                    </button>
                </div>
            `
        }
    </script>

    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: none;
            padding: 0 30px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-left h2 {
            margin: 0;
            color: white;
            font-weight: 600;
            font-size: 24px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-right: 1px solid #e4e7ed;
            box-shadow: 2px 0 6px rgba(0, 0, 0, 0.05);
        }

        .menu {
            border: none;
            background-color: transparent;
            padding: 20px 0;
        }

        .menu .el-menu-item {
            margin: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .menu .el-menu-item:hover {
            background-color: #f0f2f5;
        }

        .menu .el-menu-item.is-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .main-content {
            padding: 30px;
            background-color: #f5f7fa;
            min-height: calc(100vh - 60px);
        }

        .product-section {
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid #e4e7ed;
        }

        .section-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 28px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-indicators {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .status-indicators .el-badge {
            margin-right: 8px;
        }

        .header-stats {
            display: flex;
            gap: 40px;
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .task-card {
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid #e4e7ed;
        }

        .task-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .task-details {
            margin: 16px 0;
        }

        .task-details p {
            margin: 8px 0;
            color: #606266;
            font-size: 14px;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .task-actions .el-button {
            flex: 1;
            min-width: 60px;
        }

        .status-badge {
            margin-right: 15px;
        }

        .dialog-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Ë¥¶Âè∑‰ø°ÊÅØÊ†∑Âºè */
        .el-divider__text {
            background-color: #f5f7fa;
            padding: 0 20px;
        }

        .account-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            border-left: 4px solid #409eff;
        }

        .account-info .el-form-item {
            margin-bottom: 16px;
        }

        .preset-account-hint {
            font-size: 12px;
            color: #909399;
            margin-top: 4px;
        }

        /* URLÁõ∏ÂÖ≥Ê†∑Âºè */
        .url-hint {
            margin-top: 8px;
        }

        .config-section {
            background-color: #fafbfc;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            border: 1px solid #e4e7ed;
        }

        .config-section .el-form-item {
            margin-bottom: 20px;
        }

        .generated-url {
            background-color: #f0f9ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
        }

        .url-display {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            color: #1e40af;
            word-break: break-all;
        }

        /* Êó•ÂøóÊòæÁ§∫Ê†∑Âºè */
        .log-container {
            background-color: #1e1e1e;
            border-radius: 6px;
            padding: 12px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
        }

        .log-entries {
            color: #d4d4d4;
        }

        .log-entry {
            margin-bottom: 4px;
            display: flex;
            gap: 8px;
        }

        .log-entry.error {
            color: #f87171;
        }

        .log-entry.warning {
            color: #fbbf24;
        }

        .log-entry.success {
            color: #34d399;
        }

        .log-entry.info {
            color: #60a5fa;
        }

        .log-time {
            color: #9ca3af;
            min-width: 80px;
            font-size: 10px;
        }

        .log-message {
            flex: 1;
        }

        .no-logs {
            color: #9ca3af;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }

        /* Á≥ªÁªüÊó•ÂøóÊ†∑Âºè */
        .system-logs-container {
            height: 100%;
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e4e7ed;
        }

        /* ÂÆûÊó∂‰ªªÂä°Áä∂ÊÄÅÊ†∑Âºè */
        .current-step {
            margin: 8px 0;
            padding: 8px;
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
        }

        .latest-log {
            margin-top: 8px;
            padding: 6px 8px;
            background-color: #f8fafc;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }

        .log-text {
            margin: 0;
            font-size: 12px;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ËøõÂ∫¶Êù°Âä®Áîª */
        .el-progress__text {
            font-weight: 600;
        }

        .el-progress-bar__outer {
            transition: all 0.3s ease;
        }

        /* ‰ªªÂä°Âç°ÁâáÂä®Áîª */
        .task-card {
            transition: all 0.3s ease;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Ë°®Ê†ºËøõÂ∫¶ÂçïÂÖÉÊ†ºÊ†∑Âºè */
        .progress-cell {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .current-step-mini {
            display: flex;
            justify-content: center;
        }

        .current-step-mini .el-tag {
            font-size: 10px;
            padding: 2px 6px;
        }

        /* Ê≠•È™§ÊåáÁ§∫Âô®Ê†∑Âºè */
        .step-progress {
            margin: 12px 0;
            padding: 10px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .step-indicators {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .step-indicator {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-indicator:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #e2e8f0;
            z-index: 1;
        }

        .step-indicator.completed:not(:last-child)::after {
            background-color: #10b981;
        }

        .step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-bottom: 4px;
            background-color: #f1f5f9;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .step-indicator.completed .step-icon {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step-indicator.active .step-icon {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
            animation: pulse 2s infinite;
        }

        .step-label {
            font-size: 10px;
            color: #64748b;
            text-align: center;
            font-weight: 500;
        }

        .step-indicator.completed .step-label {
            color: #10b981;
            font-weight: 600;
        }

        .step-indicator.active .step-label {
            color: #3b82f6;
            font-weight: 600;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            50% {
                box-shadow: 0 0 0 4px rgba(59, 130, 246, 0);
            }
        }

        /* ËøûÊé•Áä∂ÊÄÅÊåáÁ§∫Âô®Ê†∑Âºè */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .connection-status.connected {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .connection-status.connecting {
            background-color: #fef3c7;
            color: #d97706;
        }

        .connection-status.disconnected {
            background-color: #fee2e2;
            color: #dc2626;
        }

        /* ‰ΩôÈ¢ù‰∏çË∂≥ÈîôËØØÊòæÁ§∫Ê†∑Âºè */
        .balance-error {
            margin: 12px 0;
            padding: 10px;
            background-color: #fef1f1;
            border: 1px solid #fca5a5;
            border-radius: 6px;
        }

        .balance-error .error-header {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #dc2626;
            margin-bottom: 8px;
        }

        .balance-error .error-content {
            padding: 4px 8px;
            background-color: #fff;
            border-radius: 4px;
            border: 1px solid #f3f4f6;
        }

        .balance-error .error-amount {
            font-size: 14px;
            color: #dc2626;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .balance-error .error-message {
            font-size: 12px;
            color: #6b7280;
        }

        /* Á§ºÂìÅÂç°ÈîôËØØÊòæÁ§∫Ê†∑Âºè */
        .gift-card-errors {
            margin: 12px 0;
            padding: 10px;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
        }

        .gift-card-errors .error-header {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #dc2626;
            margin-bottom: 8px;
        }

        .gift-card-errors .error-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .gift-card-errors .error-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background-color: #fff;
            border-radius: 4px;
            border: 1px solid #f3f4f6;
        }

        .gift-card-errors .error-message {
            flex: 1;
            font-size: 12px;
            color: #6b7280;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .header {
                padding: 0 15px;
            }

            .header-left h2 {
                font-size: 20px;
            }

            .main-content {
                padding: 20px 15px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .header-stats {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* Ëá™ÂÆö‰πâÊªöÂä®Êù° */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* IPÊ±†ÁÆ°ÁêÜÈ°µÈù¢Ê†∑Âºè */
        .status-card {
            height: 100%;
        }

        .status-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
        }

        .status-icon {
            font-size: 28px;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .status-content {
            flex: 1;
        }

        .status-title {
            font-size: 12px;
            color: #909399;
            margin-bottom: 4px;
        }

        .status-value {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 2px;
        }

        .status-desc {
            font-size: 11px;
            color: #909399;
        }

        .form-hint {
            margin-top: 5px;
        }

        .form-hint span {
            font-size: 12px;
            color: #909399;
        }

        /* ‰ª£ÁêÜÁä∂ÊÄÅÊ†áÁ≠æÊ†∑Âºè */
        .el-tag.el-tag--success {
            background-color: #f0f9ff;
            border-color: #67c23a;
            color: #67c23a;
        }

        .el-tag.el-tag--warning {
            background-color: #fdf6ec;
            border-color: #e6a23c;
            color: #e6a23c;
        }

        .el-tag.el-tag--danger {
            background-color: #fef0f0;
            border-color: #f56c6c;
            color: #f56c6c;
        }

        .el-tag.el-tag--info {
            background-color: #f4f4f5;
            border-color: #909399;
            color: #909399;
        }

        /* ÂìçÂ∫îÂºèÂ∏ÉÂ±Ä */
        @media (max-width: 768px) {
            .status-card .el-col {
                margin-bottom: 10px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-actions {
                margin-top: 10px;
                width: 100%;
            }
            
            .header-actions .el-button {
                margin-bottom: 5px;
            }
        }
    </style>


</body>
</html>
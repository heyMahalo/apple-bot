# IP池管理界面使用说明

## 概述

已为你的Apple自动化系统前端添加了完整的IP池管理界面，方便你配置和管理代理IP池，避免礼品卡付款时被封禁。

## 功能特性

### 1. IP状态监控面板
- **当前IP显示**: 显示当前使用的IP地址和地理位置 
- **代理池统计**: 显示代理池的总数量和可用数量
- **礼品卡跟踪**: 显示正在跟踪的礼品卡数量
- **轮换状态**: 显示IP轮换和礼品卡专用轮换的开关状态

### 2. 代理设置管理
- **启用IP轮换**: 总开关，控制是否启用IP轮换功能
- **礼品卡专用轮换**: 控制是否在礼品卡付款时自动切换IP
- **每IP最大礼品卡数**: 设置每个IP最多使用多少张礼品卡(1-10张)
- **轮换间隔**: 设置自动轮换IP的时间间隔(60-3600秒)

### 3. 代理服务器管理
- **手动添加代理**: 支持添加HTTP/HTTPS/SOCKS5代理
- **批量导入**: 通过API接口批量导入代理服务器
- **状态监控**: 实时显示每个代理的状态、成功率、响应时间
- **测试验证**: 可以单独测试每个代理的可用性
- **封禁管理**: 手动封禁或解封代理IP

## 使用步骤

### 第一步：访问IP池管理页面
1. 启动系统后，在浏览器中打开 `http://localhost:5000`
2. 在左侧菜单中点击 "🌐 IP池管理"

### 第二步：配置IP轮换设置
1. 在"IP池设置"卡片中：
   - 开启"启用IP轮换"开关
   - 开启"礼品卡专用轮换"开关  
   - 设置"每IP最大礼品卡数"为2（推荐值）
   - 设置"轮换间隔"为300秒（5分钟）

### 第三步：添加代理服务器

#### 方法A：手动添加单个代理
1. 点击"添加代理"按钮
2. 填写代理信息：
   - **主机地址**: 代理服务器IP或域名
   - **端口**: 代理端口号
   - **协议类型**: 选择HTTP/HTTPS/SOCKS5
   - **国家/地区**: 代理所在国家代码(如US, UK, CA)
   - **用户名/密码**: 如果代理需要认证则填写
3. 点击"添加代理"完成

#### 方法B：通过API批量导入
1. 点击"配置API"按钮
2. 选择API类型：
   - **自定义API**: 使用你自己的代理API
   - **ProxyMesh**: ProxyMesh服务
   - **Bright Data**: Bright Data服务
   - **Oxylabs**: Oxylabs服务
   - **SmartProxy**: SmartProxy服务
3. 填写API配置：
   - **API地址**: 代理服务商提供的API端点
   - **API密钥**: 你的API访问密钥
   - **请求头**: 自定义HTTP请求头(JSON格式)
   - **同步间隔**: 自动同步代理列表的间隔时间
4. 点击"测试API连接"验证配置
5. 点击"立即同步代理"导入代理列表
6. 点击"保存配置"保存设置

### 第四步：管理代理列表
在代理列表中，你可以：
- **查看状态**: 绿色=正常，红色=失败，黄色=被封禁
- **查看成功率**: 进度条显示代理的成功率
- **测试代理**: 点击"测试"按钮验证代理可用性
- **封禁代理**: 点击"封禁"将代理标记为不可用
- **解封代理**: 点击"解封"重新启用被封禁的代理
- **删除代理**: 从代理池中永久删除代理

### 第五步：监控IP轮换效果
- 点击"刷新状态"查看最新的IP池状态
- 点击"手动轮换"测试IP切换功能
- 在运行任务时观察日志，确认礼品卡付款前会自动切换IP

## 代理配置示例

### 免费代理示例
```
主机地址: 45.76.96.205
端口: 8080
协议类型: HTTP
国家/地区: US
```

### 付费代理示例(需认证)
```
主机地址: proxy.provider.com
端口: 3128
协议类型: HTTP
国家/地区: UK
用户名: your_username
密码: your_password
```

### API配置示例
```json
{
  "apiType": "custom",
  "apiUrl": "https://your-proxy-api.com/api/proxies",
  "apiKey": "your_api_key_here",
  "headers": "{\"Authorization\": \"Bearer your_token\"}",
  "syncInterval": 60
}
```

## 推荐的代理服务商

### 1. ProxyMesh
- 网址: https://proxymesh.com
- 特点: 高匿名性，支持多种协议
- 价格: $10-100/月

### 2. Bright Data (原Luminati)
- 网址: https://brightdata.com  
- 特点: 全球IP覆盖，高成功率
- 价格: 按流量计费

### 3. Oxylabs
- 网址: https://oxylabs.io
- 特点: 企业级代理，稳定性好
- 价格: $300+/月

### 4. SmartProxy
- 网址: https://smartproxy.com
- 特点: 价格适中，易于使用
- 价格: $75-400/月

## 故障排除

### 1. 代理测试失败
- 检查代理地址和端口是否正确
- 确认用户名密码是否准确
- 尝试更换协议类型(HTTP/HTTPS/SOCKS5)

### 2. API同步失败
- 验证API地址是否可达
- 检查API密钥是否有效
- 确认请求头格式是否正确(必须是有效JSON)

### 3. IP轮换不生效
- 确认"启用IP轮换"开关已开启
- 检查代理池中是否有可用代理
- 查看控制台日志了解错误详情

### 4. 礼品卡仍被拒绝
- 增加代理池中的代理数量
- 降低"每IP最大礼品卡数"设置
- 选择不同地区的代理IP
- 检查代理质量和匿名性

## 安全提醒

1. **代理质量**: 选择高质量的付费代理，避免使用免费公共代理
2. **IP地理位置**: 选择与目标地区匹配的代理IP
3. **认证信息**: 妥善保管代理服务商的用户名密码
4. **API密钥**: 不要在公共场所暴露API密钥
5. **定期更新**: 定期更新代理列表，移除失效的代理

## 高级技巧

1. **混合使用**: 同时配置多个代理服务商，提高可用性
2. **地区分布**: 选择不同国家的代理，模拟真实用户行为
3. **定时同步**: 设置合适的同步间隔，保持代理列表更新
4. **监控告警**: 定期检查代理成功率，及时替换失效代理
5. **负载均衡**: 合理设置"每IP最大礼品卡数"，避免单个IP过度使用

通过合理配置和使用IP池管理功能，可以有效避免礼品卡付款时的IP封禁问题，提高自动化任务的成功率。